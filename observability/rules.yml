groups:
  - name: soulbrowser_memory_self_heal
    rules:
      - alert: MemoryHitRateLow
        expr: (soul_memory_hit_rate_percent / 100) < 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Memory hit rate below 50%"
          description: "soul_memory_hit_rate_percent dropped below 50% for more than 5 minutes. Investigate template drift or namespace misses."
      - alert: SelfHealAutoRetrySpike
        expr: increase(soul_self_heal_auto_retry_total[5m]) > 5
        for: 0m
        labels:
          severity: warning
        annotations:
          summary: "Self-heal auto-retries exceeded 5 in 5 minutes"
          description: "Self-heal auto-retry counter increased by more than 5 in the last 5 minutes, indicating unstable flows."
  - name: soulbrowser_watchdog
    rules:
      - alert: WatchdogEventSpike
        expr: sum by (kind)(increase(soul_agent_watchdog_events_total[5m])) > 3
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Watchdog {{ $labels.kind }} spike detected"
          description: |
            More than three {{ $labels.kind }} watchdog events were recorded within the last five minutes.
            Automation webhook (/self-heal-alerts) will receive this alert for immediate triage in automation.do.
