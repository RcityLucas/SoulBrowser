# SoulBrowser · AI 体验开发详细规划

**文档日期**: 2025-10-21  
**目的**: 规划 SoulBrowser 在完成 1.0 基础能力后，如何从用户视角提供媲美当代流行 AI 浏览器的完整体验。

---

## 1. 用户价值与目标体验

### 1.1 目标用户
- **自动化工程师 / AI 团队**：需要可靠、可审计的浏览任务执行与脚本集成。
- **业务运营 / 增长团队**：期望自然语言驱动的调研、录入、监测自动化。
- **安全与合规人员**：要求全过程可追溯、可控的自动化行为与隐私保护。

### 1.2 目标体验能力
1. **自然语言对话驱动**：用户通过对话描述任务，系统生成可解释的计划并执行。
2. **可视化伴随界面**：实时展示浏览器画面、行动轨迹、指标与证据。
3. **智能任务记忆**：跨会话保存目标、上下文、常用流程模板，为个性化执行服务。
4. **生态联动**：可选择启用插件/外部 API，形成「AI 浏览工作站」。
5. **全链路治理**：为每次执行提供指标、回放、隐私脱敏与策略守护。

---

## 2. 能力差距概览
| 能力 | 现状 | 差距 |
|------|------|------|
| 自动化执行引擎 | L0-L5 已具备 | 需对话式编排、计划解释、失败自愈增强 |
| 对话与 Agent | 未提供 | 需要 LLM 核心、工具选择策略、可解释反馈 |
| 用户界面 | CLI & 测试驱动 | 需构建 Web / 桌面控制台，展示实时页面与日志 |
| 记忆与个性化 | L4 基础存储 | 需语义记忆、任务模板、偏好策略 |
| 插件生态 | L7 框架待启用 | 需安全模型、发布/审核流程与 UI 接入 |
| 观测与治理 | L6 功能待补 | 需用户级仪表盘、告警、审计视图 |

---

## 3. 架构扩展原则
1. **延续 L0-L7 分层**：新增能力尽量复用现有层次，必要时引入 L8「Agent & Experience」层。
2. **对话≠黑盒**：对话层必须输出计划、步骤和证据，保持可审计性。
3. **工具优先**：LLM 调度面向 L5 工具，确保稳定与治理策略统一。
4. **隐私优先**：默认脱敏 + 用户确认，所有持久化内容遵循策略中心配置。
5. **可渐进交付**：以阶段性 MVP 推进，每个阶段可独立发布给早期用户。

---

## 4. 阶段化开发计划

### 阶段 0 · 基础巩固（并行执行）
> 目标：完成 `PRODUCT_COMPLETION_PLAN.md` 中 1.0 收尾项，为对话体验打牢基础。
- 完成 L0-L4 剩余任务、观测指标、L7 接口硬化，并提供真实浏览器集成测试矩阵。
- 发布 `/metrics` 和回放 CLI，确保 State Center 事件可供后续控制台/回放使用。
- 输出稳定版本 `v1.0.0`，作为后续体验的基线；验收时 L0/L1/L4 状态文档 90%+，全链路回归套件稳定。

### 阶段 1 · 对话式 Agent MVP（2-4 周）
**目标**：实现「自然语言下达任务 → 输出可解释计划（含视觉锚点）→ 调用 L5 工具执行 → 回报结果」，提供 CLI 与 Web 控制台体验。
- #### 1.1 规划与推理
  - 引入 `agent-core`（L8）：Prompt 模板、上下文构造、工具清单与策略指引。
  - 计划输出结构化 JSON + 可读说明；接入 VLM 生成截图 bounding box 兜底 DOM 解析。
  - 支持云端/本地模型的抽象接口，并记录模型版本与置信度。
- #### 1.2 执行编排与自愈
  - 将 `AgentPlan` 转为 ActionFlow，调用 Scheduler；落地单步重试→重新规划→人工确认策略。
  - 统一记录 Observation 序列，确保回放和审计可用。
- #### 1.3 用户界面
  - 构建 Web 控制台 MVP：对话区、计划卡片、视觉高亮（Overlay）、实时截图流、任务状态栏。
  - CLI 扩展 `soulbrowser chat`，支持导出计划/执行日志 JSON。
- #### 1.4 验收指标
  - 20+ 典型任务脚本通过（搜索、表单、抓取、策略拒绝等），含视觉兜底场景。
  - 计划、执行日志、截图可导出，视觉高亮可二次确认。
  - 控制台在 Chrome/Edge 最新版本稳定，WebSocket 延迟 <1s。

#### 近期落地进度（2025-12）
- ✅ **后端全托管管线**：`soulbrowser serve --surface console` 已承载对话流量，`/api/chat` 可传入/返回 `session_id`，若未提供会自动在 registry + session service 中创建持久会话，并把 `session_id` 写入 `PersistedPlanRecord` 与任务元数据，便于追踪。
- ✅ **实时可视化链路**：`SessionService` 订阅任务流事件，将截图与 overlay 汇聚到会话级 SSE (`/api/sessions/:id/live`)，并带分享令牌控制访问，前端能即时播放 live viewer。
- ✅ **控制台体验**：Chat 页新增「持久会话」控制卡（刷新/创建/切换会话并同步到 URL），Sessions 页实时画面与“最新事件”面板已连通；任务列表的 metadata 也包含 `session_id`，支持跳转对应会话。
- ✅ **类型与构建**：TS/前端类型更新覆盖新字段，`npm run type-check` 与 `cargo check` 均通过，确保前后端契约统一。

### 阶段 2 · 个性化与记忆（3-4 周）
**目标**：让 Agent 记住用户偏好、历史计划并加速重复任务，提供视觉记忆与模板复用能力。
- 扩展 L4 `recipes` 为 `memory-center`，支持语义/视觉混合记忆、标签、TTL 管控。
- 会话档案记录常用网站、偏好、策略设置；通过控制台/CLI 查看与管理。
- 模板化执行与脚本导出：用户可将对话保存为模板，参数化复用，与 Browser Use 脚本导出对齐。
- 记忆导航：控制台展示历史截图锚点，Agent 在规划时主动引用记忆建议。
- 隐私策略：「忘记我」流程、审计包导出、敏感字段脱敏，满足企业合规。
- 度量：记忆命中率、模板复用率、视觉记忆命中率、推荐采纳率。

### 阶段 3 · 生态扩展（4-5 周）
**目标**：开放插件与外部 API，支持跨平台协同，对齐 Browser Use 的 REST/SDK 与示例任务体验。
- 启用 L7 Adapter：OAuth2/Token 审计、速率限制、幂等；提供 REST/gRPC 接口与 TypeScript/Python SDK。
- 插件仓库：Manifest 规范、签名校验、策略审批、灰度发布；控制台提供安装/启用与权限提示。
- 外部事件触发：Webhook/gRPC 触发任务、dry-run 模式、回调证据包。
- 示例任务库：官方/社区模板一键导入，配合控制台与 SDK 快速复用。
- 安全审计：插件沙盒指标、权限提示、执行证据记录，异常流量自动限流/封禁。

### 阶段 4 · 专业化体验（持续迭代）
- 多用户协作：共驾模式、审批流、实时批注，与 Browser Use 协作控制台对齐。
- 智能监控：自定义规则、告警中心、回放链接，一体化审计。
- 多端体验：桌面客户端（离线能力）、浏览器扩展、IDE/CLI 插件。
- 多模态增强：语音输入、实时转写、OCR/视频识别、脚本录制/分享，支持团队复盘与培训。
- 协同指标：共享任务完成率、审批通过时长、告警响应时间、多端活跃度。

---

## 5. 关键技术要点
- **LLM 接入**：提供抽象接口 `AgentModel`，支持云端/私有部署；缓存 Prompt/检索策略。
- **计划格式**：统一 `AgentPlan` → `ActionFlow` 转换，保留步骤、待验证条件、重试策略。
- **实时可视化**：基于 L6 指标 + L0 事件，构建 WebSocket 推送（事件、截图、指标）。
- **安全策略**：默认最小权限；对话中需确认高风险操作（下载、支付等）。
- **扩展能力**：插件执行与策略中心联动，记录所有外部请求的审计日志。

---

## 6. 测试与验证矩阵
| 层级 | 测试类型 | 说明 |
|------|----------|------|
| L0-L1 | 集成/压力 | 真实 Chrome headless/headful、网络中断、自愈测试 |
| L2-L3 | 感知/行动回归 | 典型页面集（表格、复杂 DOM、动态内容） |
| L8 | 计划/工具选择 | 500+ 对话样本，覆盖常见+极端指令 |
| UI | 端到端功能 | 浏览器兼容性、WebSocket 稳定性、Accessibility 检测 |
| 安全 | 策略/隐私 | 插件权限、敏感字段脱敏、审计日志完整性 |

---

## 7. 度量与成功标准
- **任务成功率 ≥ 90%**：定义为无需人工干预完成。
- **重新规划率 ≤ 15%**：执行中最多一次重新规划可接受。
- **计划可解释度**：每一步都提供工具名、目标和验证条件。
- **用户满意度**：内测用户对对话式体验打分 ≥ 4/5。
- **治理指标**：所有高风险操作均有策略确认日志。

---

## 8. 风险与缓解
| 风险 | 描述 | 缓解措施 |
|------|------|----------|
| LLM 误判 | 生成危险或违反策略的操作 | 构建策略约束 + 人工确认环节 + 关键操作白名单 |
| UI 实时性 | 截图/事件延迟影响体验 | 引入增量 DOM 更新/低延迟 codec，增加预取缓存 |
| Chrome 版本漂移 | CDP 行为变化导致失败 | 建立版本监控、回归矩阵、自动兼容层 |
| 数据隐私 | 对话/页面数据泄露 | 开启默认脱敏、用户可选完全本地模型、审计日志 |
| 插件安全 | 第三方代码风险 | 强制沙箱、权限清单、签名校验与审批流程 |

---

## 9. 文档与交付物
- `docs/PRODUCT_COMPLETION_PLAN.md`：基础能力交付计划（现已发布）。
- `docs/AI_BROWSER_EXPERIENCE_PLAN.md`：本文件，覆盖 AI 浏览体验。
- 后续需新增：
- `docs/plans/ARCHIVE/BROWSER_USE_ALIGNMENT.md` —— Browser Use 差距追踪与阶段性补齐记录（阶段覆盖日志与严格校验已补齐）。
  - `docs/ui/` —— 控制台 IA、视觉高亮、组件规范、Browser Use UI 模式对齐。
  - `docs/plugins/` —— Manifest 规范、审核流程、REST/SDK 文档、生态差距追踪。
  - `L8 Agent 与体验（Agent & Experience）` —— 分阶段技术实现与逻辑规约文档。

---

## 10. 下一步行动
1. 在阶段 0 收尾过程中，补充对话式功能所需的指标与回放输出，并将 L0-L4 状态同步到新文档。
2. 阶段 1：确定首选 LLM/VLM、落地 `agent-core` 与 ActionFlow、自愈策略、视觉高亮控制台。
3. 阶段 2：上线 memory-center、模板库与隐私治理，完成记忆/模板用户手册。
4. 阶段 3：发布 REST/SDK 与插件仓库，填充示例任务库与 Browser Use 对标报告。
5. 阶段 4：推进协作、监控、多端、多模态能力，并持续更新差距追踪文档。

---
**完成上述阶梯式开发后，SoulBrowser 将具备与主流 AI 浏览器相当甚至更强的弹性、可审计与扩展能力。**
