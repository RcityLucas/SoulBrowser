var Aa=Object.defineProperty;var $a=(e,t,r)=>t in e?Aa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var zs=(e,t,r)=>$a(e,typeof t!="symbol"?t+"":t,r);import{r as y,c as La,g as hn,R as mn,u as Fa,f as za,O as Ma,B as Ua,h as Da,i as at,N as Ba}from"./react-vendor-4PqL0t5k.js";import{L as sr,T as xn,a as q,d as We,M as Ha,R as Or,b as qa,c as yn,e as Ja,f as hs,g as Va,h as mr,i as Ft,C as he,j as G,k as _n,l as Wa,m as Ga,n as Ka,o as Ya,I as xe,p as I,q as is,r as Xa,S as L,s as Pe,t as Re,B as Z,u as Qa,v as P,w as Za,x as gn,F as z,y as $t,z as xr,A as Le,D as eo,E as to,G as so,H as U,J as ro,K as me,N as Ar,O as cs,P as zt,Q as Tt,U as no,V as oe,W as ao,X as oo,Y as lo,Z as yr,_ as io,$ as co,a0 as uo,a1 as po,a2 as ds,a3 as rr,a4 as fo,a5 as ho,a6 as mo,a7 as $r,a8 as xo,a9 as yo,aa as _o,ab as go}from"./antd-vendor-BKEjgGZA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();var jn={exports:{}},gs={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jo=y,bo=Symbol.for("react.element"),vo=Symbol.for("react.fragment"),wo=Object.prototype.hasOwnProperty,So=jo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,To={key:!0,ref:!0,__self:!0,__source:!0};function bn(e,t,r){var n,a={},o=null,l=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)wo.call(t,n)&&!To.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:bo,type:e,key:o,ref:l,props:a,_owner:So.current}}gs.Fragment=vo;gs.jsx=bn;gs.jsxs=bn;jn.exports=gs;var s=jn.exports,nr={},Lr=La;nr.createRoot=Lr.createRoot,nr.hydrateRoot=Lr.hydrateRoot;var js={},vn={exports:{}};(function(e){function t(r){return r&&r.__esModule?r:{default:r}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(vn);var bs=vn.exports,vs={};Object.defineProperty(vs,"__esModule",{value:!0});vs.default=void 0;var Co={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};vs.default=Co;var ws={},Ht={},Ss={},wn={exports:{}},Sn={exports:{}},Tn={exports:{}},Cn={exports:{}};(function(e){function t(r){"@babel/helpers - typeof";return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Cn);var kn=Cn.exports,In={exports:{}};(function(e){var t=kn.default;function r(n,a){if(t(n)!="object"||!n)return n;var o=n[Symbol.toPrimitive];if(o!==void 0){var l=o.call(n,a||"default");if(t(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(In);var ko=In.exports;(function(e){var t=kn.default,r=ko;function n(a){var o=r(a,"string");return t(o)=="symbol"?o:o+""}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Tn);var Io=Tn.exports;(function(e){var t=Io;function r(n,a,o){return(a=t(a))in n?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Sn);var No=Sn.exports;(function(e){var t=No;function r(a,o){var l=Object.keys(a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(a);o&&(c=c.filter(function(p){return Object.getOwnPropertyDescriptor(a,p).enumerable})),l.push.apply(l,c)}return l}function n(a){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?r(Object(l),!0).forEach(function(c){t(a,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):r(Object(l)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(l,c))})}return a}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(wn);var Ro=wn.exports,Ts={};Object.defineProperty(Ts,"__esModule",{value:!0});Ts.commonLocale=void 0;Ts.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var Po=bs.default;Object.defineProperty(Ss,"__esModule",{value:!0});Ss.default=void 0;var Fr=Po(Ro),Eo=Ts,Oo=(0,Fr.default)((0,Fr.default)({},Eo.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});Ss.default=Oo;var qt={};Object.defineProperty(qt,"__esModule",{value:!0});qt.default=void 0;const Ao={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};qt.default=Ao;var Nn=bs.default;Object.defineProperty(Ht,"__esModule",{value:!0});Ht.default=void 0;var $o=Nn(Ss),Lo=Nn(qt);const Rn={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},$o.default),timePickerLocale:Object.assign({},Lo.default)};Rn.lang.ok="确定";Ht.default=Rn;var Fo=bs.default;Object.defineProperty(ws,"__esModule",{value:!0});ws.default=void 0;var zo=Fo(Ht);ws.default=zo.default;var Cs=bs.default;Object.defineProperty(js,"__esModule",{value:!0});js.default=void 0;var Mo=Cs(vs),Uo=Cs(ws),Do=Cs(Ht),Bo=Cs(qt);const $e="${label}不是一个有效的${type}",Ho={locale:"zh-cn",Pagination:Mo.default,DatePicker:Do.default,TimePicker:Bo.default,Calendar:Uo.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:$e,method:$e,array:$e,object:$e,number:$e,date:$e,boolean:$e,integer:$e,float:$e,regexp:$e,email:$e,url:$e,hex:$e},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};js.default=Ho;var qo=js;const Jo=hn(qo),Vo="_layout_1lexu_1",Wo="_header_1lexu_6",Go="_logo_1lexu_15",Ko="_logoIcon_1lexu_21",Yo="_logoText_1lexu_25",Xo="_headerRight_1lexu_32",Qo="_version_1lexu_38",Zo="_sider_1lexu_43",el="_content_1lexu_48",Ve={layout:Vo,header:Wo,logo:Go,logoIcon:Ko,logoText:Yo,headerRight:Xo,version:Qo,sider:Zo,content:el},tl={},zr=e=>{let t;const r=new Set,n=(u,v)=>{const g=typeof u=="function"?u(t):u;if(!Object.is(g,t)){const w=t;t=v??(typeof g!="object"||g===null)?g:Object.assign({},t,g),r.forEach(f=>f(t,w))}},a=()=>t,p={setState:n,getState:a,getInitialState:()=>i,subscribe:u=>(r.add(u),()=>r.delete(u)),destroy:()=>{(tl?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},i=t=e(n,a,p);return p},sl=e=>e?zr(e):zr;var Pn={exports:{}},En={},On={exports:{}},An={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct=y;function rl(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var nl=typeof Object.is=="function"?Object.is:rl,al=Ct.useState,ol=Ct.useEffect,ll=Ct.useLayoutEffect,il=Ct.useDebugValue;function cl(e,t){var r=t(),n=al({inst:{value:r,getSnapshot:t}}),a=n[0].inst,o=n[1];return ll(function(){a.value=r,a.getSnapshot=t,Ms(a)&&o({inst:a})},[e,r,t]),ol(function(){return Ms(a)&&o({inst:a}),e(function(){Ms(a)&&o({inst:a})})},[e]),il(r),r}function Ms(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!nl(e,r)}catch{return!0}}function dl(e,t){return t()}var ul=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?dl:cl;An.useSyncExternalStore=Ct.useSyncExternalStore!==void 0?Ct.useSyncExternalStore:ul;On.exports=An;var pl=On.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ks=y,fl=pl;function hl(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ml=typeof Object.is=="function"?Object.is:hl,xl=fl.useSyncExternalStore,yl=ks.useRef,_l=ks.useEffect,gl=ks.useMemo,jl=ks.useDebugValue;En.useSyncExternalStoreWithSelector=function(e,t,r,n,a){var o=yl(null);if(o.current===null){var l={hasValue:!1,value:null};o.current=l}else l=o.current;o=gl(function(){function p(w){if(!i){if(i=!0,u=w,w=n(w),a!==void 0&&l.hasValue){var f=l.value;if(a(f,w))return v=f}return v=w}if(f=v,ml(u,w))return f;var b=n(w);return a!==void 0&&a(f,b)?(u=w,f):(u=w,v=b)}var i=!1,u,v,g=r===void 0?null:r;return[function(){return p(t())},g===null?void 0:function(){return p(g())}]},[t,r,n,a]);var c=xl(e,o[0],o[1]);return _l(function(){l.hasValue=!0,l.value=c},[c]),jl(c),c};Pn.exports=En;var bl=Pn.exports;const vl=hn(bl),$n={},{useDebugValue:wl}=mn,{useSyncExternalStoreWithSelector:Sl}=vl;let Mr=!1;const Tl=e=>e;function Cl(e,t=Tl,r){($n?"production":void 0)!=="production"&&r&&!Mr&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Mr=!0);const n=Sl(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return wl(n),n}const kl=e=>{($n?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?sl(e):e,r=(n,a)=>Cl(t,n,a);return Object.assign(r,t),r},Ln=e=>kl,Il={};function Nl(e,t){let r;try{r=e()}catch{return}return{getItem:a=>{var o;const l=p=>p===null?null:JSON.parse(p,void 0),c=(o=r.getItem(a))!=null?o:null;return c instanceof Promise?c.then(l):l(c)},setItem:(a,o)=>r.setItem(a,JSON.stringify(o,void 0)),removeItem:a=>r.removeItem(a)}}const Mt=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return Mt(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return Mt(n)(r)}}}},Rl=(e,t)=>(r,n,a)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:_=>_,version:0,merge:(_,E)=>({...E,..._}),...t},l=!1;const c=new Set,p=new Set;let i;try{i=o.getStorage()}catch{}if(!i)return e((..._)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(..._)},n,a);const u=Mt(o.serialize),v=()=>{const _=o.partialize({...n()});let E;const N=u({state:_,version:o.version}).then(B=>i.setItem(o.name,B)).catch(B=>{E=B});if(E)throw E;return N},g=a.setState;a.setState=(_,E)=>{g(_,E),v()};const w=e((..._)=>{r(..._),v()},n,a);let f;const b=()=>{var _;if(!i)return;l=!1,c.forEach(N=>N(n()));const E=((_=o.onRehydrateStorage)==null?void 0:_.call(o,n()))||void 0;return Mt(i.getItem.bind(i))(o.name).then(N=>{if(N)return o.deserialize(N)}).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==o.version){if(o.migrate)return o.migrate(N.state,N.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return N.state}).then(N=>{var B;return f=o.merge(N,(B=n())!=null?B:w),r(f,!0),v()}).then(()=>{E==null||E(f,void 0),l=!0,p.forEach(N=>N(f))}).catch(N=>{E==null||E(void 0,N)})};return a.persist={setOptions:_=>{o={...o,..._},_.getStorage&&(i=_.getStorage())},clearStorage:()=>{i==null||i.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>b(),hasHydrated:()=>l,onHydrate:_=>(c.add(_),()=>{c.delete(_)}),onFinishHydration:_=>(p.add(_),()=>{p.delete(_)})},b(),f||w},Pl=(e,t)=>(r,n,a)=>{let o={storage:Nl(()=>localStorage),partialize:b=>b,version:0,merge:(b,_)=>({..._,...b}),...t},l=!1;const c=new Set,p=new Set;let i=o.storage;if(!i)return e((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...b)},n,a);const u=()=>{const b=o.partialize({...n()});return i.setItem(o.name,{state:b,version:o.version})},v=a.setState;a.setState=(b,_)=>{v(b,_),u()};const g=e((...b)=>{r(...b),u()},n,a);a.getInitialState=()=>g;let w;const f=()=>{var b,_;if(!i)return;l=!1,c.forEach(N=>{var B;return N((B=n())!=null?B:g)});const E=((_=o.onRehydrateStorage)==null?void 0:_.call(o,(b=n())!=null?b:g))||void 0;return Mt(i.getItem.bind(i))(o.name).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==o.version){if(o.migrate)return[!0,o.migrate(N.state,N.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,N.state];return[!1,void 0]}).then(N=>{var B;const[A,re]=N;if(w=o.merge(re,(B=n())!=null?B:g),r(w,!0),A)return u()}).then(()=>{E==null||E(w,void 0),w=n(),l=!0,p.forEach(N=>N(w))}).catch(N=>{E==null||E(void 0,N)})};return a.persist={setOptions:b=>{o={...o,...b},b.storage&&(i=b.storage)},clearStorage:()=>{i==null||i.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>f(),hasHydrated:()=>l,onHydrate:b=>(c.add(b),()=>{c.delete(b)}),onFinishHydration:b=>(p.add(b),()=>{p.delete(b)})},o.skipHydration||f(),w||g},El=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((Il?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Rl(e,t)):Pl(e,t),Ol=El;function Fn(e,t){return function(){return e.apply(t,arguments)}}const{toString:Al}=Object.prototype,{getPrototypeOf:_r}=Object,{iterator:Is,toStringTag:zn}=Symbol,Ns=(e=>t=>{const r=Al.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Be=e=>(e=e.toLowerCase(),t=>Ns(t)===e),Rs=e=>t=>typeof t===e,{isArray:Nt}=Array,kt=Rs("undefined");function Jt(e){return e!==null&&!kt(e)&&e.constructor!==null&&!kt(e.constructor)&&Ee(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Mn=Be("ArrayBuffer");function $l(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Mn(e.buffer),t}const Ll=Rs("string"),Ee=Rs("function"),Un=Rs("number"),Vt=e=>e!==null&&typeof e=="object",Fl=e=>e===!0||e===!1,us=e=>{if(Ns(e)!=="object")return!1;const t=_r(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(zn in e)&&!(Is in e)},zl=e=>{if(!Vt(e)||Jt(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Ml=Be("Date"),Ul=Be("File"),Dl=Be("Blob"),Bl=Be("FileList"),Hl=e=>Vt(e)&&Ee(e.pipe),ql=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ee(e.append)&&((t=Ns(e))==="formdata"||t==="object"&&Ee(e.toString)&&e.toString()==="[object FormData]"))},Jl=Be("URLSearchParams"),[Vl,Wl,Gl,Kl]=["ReadableStream","Request","Response","Headers"].map(Be),Yl=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Wt(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,a;if(typeof e!="object"&&(e=[e]),Nt(e))for(n=0,a=e.length;n<a;n++)t.call(null,e[n],n,e);else{if(Jt(e))return;const o=r?Object.getOwnPropertyNames(e):Object.keys(e),l=o.length;let c;for(n=0;n<l;n++)c=o[n],t.call(null,e[c],c,e)}}function Dn(e,t){if(Jt(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,a;for(;n-- >0;)if(a=r[n],t===a.toLowerCase())return a;return null}const ct=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bn=e=>!kt(e)&&e!==ct;function ar(){const{caseless:e,skipUndefined:t}=Bn(this)&&this||{},r={},n=(a,o)=>{const l=e&&Dn(r,o)||o;us(r[l])&&us(a)?r[l]=ar(r[l],a):us(a)?r[l]=ar({},a):Nt(a)?r[l]=a.slice():(!t||!kt(a))&&(r[l]=a)};for(let a=0,o=arguments.length;a<o;a++)arguments[a]&&Wt(arguments[a],n);return r}const Xl=(e,t,r,{allOwnKeys:n}={})=>(Wt(t,(a,o)=>{r&&Ee(a)?e[o]=Fn(a,r):e[o]=a},{allOwnKeys:n}),e),Ql=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Zl=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},ei=(e,t,r,n)=>{let a,o,l;const c={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),o=a.length;o-- >0;)l=a[o],(!n||n(l,e,t))&&!c[l]&&(t[l]=e[l],c[l]=!0);e=r!==!1&&_r(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},ti=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},si=e=>{if(!e)return null;if(Nt(e))return e;let t=e.length;if(!Un(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},ri=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&_r(Uint8Array)),ni=(e,t)=>{const n=(e&&e[Is]).call(e);let a;for(;(a=n.next())&&!a.done;){const o=a.value;t.call(e,o[0],o[1])}},ai=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},oi=Be("HTMLFormElement"),li=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,a){return n.toUpperCase()+a}),Ur=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),ii=Be("RegExp"),Hn=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Wt(r,(a,o)=>{let l;(l=t(a,o,e))!==!1&&(n[o]=l||a)}),Object.defineProperties(e,n)},ci=e=>{Hn(e,(t,r)=>{if(Ee(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Ee(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},di=(e,t)=>{const r={},n=a=>{a.forEach(o=>{r[o]=!0})};return Nt(e)?n(e):n(String(e).split(t)),r},ui=()=>{},pi=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function fi(e){return!!(e&&Ee(e.append)&&e[zn]==="FormData"&&e[Is])}const hi=e=>{const t=new Array(10),r=(n,a)=>{if(Vt(n)){if(t.indexOf(n)>=0)return;if(Jt(n))return n;if(!("toJSON"in n)){t[a]=n;const o=Nt(n)?[]:{};return Wt(n,(l,c)=>{const p=r(l,a+1);!kt(p)&&(o[c]=p)}),t[a]=void 0,o}}return n};return r(e,0)},mi=Be("AsyncFunction"),xi=e=>e&&(Vt(e)||Ee(e))&&Ee(e.then)&&Ee(e.catch),qn=((e,t)=>e?setImmediate:t?((r,n)=>(ct.addEventListener("message",({source:a,data:o})=>{a===ct&&o===r&&n.length&&n.shift()()},!1),a=>{n.push(a),ct.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ee(ct.postMessage)),yi=typeof queueMicrotask<"u"?queueMicrotask.bind(ct):typeof process<"u"&&process.nextTick||qn,_i=e=>e!=null&&Ee(e[Is]),h={isArray:Nt,isArrayBuffer:Mn,isBuffer:Jt,isFormData:ql,isArrayBufferView:$l,isString:Ll,isNumber:Un,isBoolean:Fl,isObject:Vt,isPlainObject:us,isEmptyObject:zl,isReadableStream:Vl,isRequest:Wl,isResponse:Gl,isHeaders:Kl,isUndefined:kt,isDate:Ml,isFile:Ul,isBlob:Dl,isRegExp:ii,isFunction:Ee,isStream:Hl,isURLSearchParams:Jl,isTypedArray:ri,isFileList:Bl,forEach:Wt,merge:ar,extend:Xl,trim:Yl,stripBOM:Ql,inherits:Zl,toFlatObject:ei,kindOf:Ns,kindOfTest:Be,endsWith:ti,toArray:si,forEachEntry:ni,matchAll:ai,isHTMLForm:oi,hasOwnProperty:Ur,hasOwnProp:Ur,reduceDescriptors:Hn,freezeMethods:ci,toObjectSet:di,toCamelCase:li,noop:ui,toFiniteNumber:pi,findKey:Dn,global:ct,isContextDefined:Bn,isSpecCompliantForm:fi,toJSONObject:hi,isAsyncFn:mi,isThenable:xi,setImmediate:qn,asap:yi,isIterable:_i};function J(e,t,r,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}h.inherits(J,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:h.toJSONObject(this.config),code:this.code,status:this.status}}});const Jn=J.prototype,Vn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Vn[e]={value:e}});Object.defineProperties(J,Vn);Object.defineProperty(Jn,"isAxiosError",{value:!0});J.from=(e,t,r,n,a,o)=>{const l=Object.create(Jn);h.toFlatObject(e,l,function(u){return u!==Error.prototype},i=>i!=="isAxiosError");const c=e&&e.message?e.message:"Error",p=t==null&&e?e.code:t;return J.call(l,c,p,r,n,a),e&&l.cause==null&&Object.defineProperty(l,"cause",{value:e,configurable:!0}),l.name=e&&e.name||"Error",o&&Object.assign(l,o),l};const gi=null;function or(e){return h.isPlainObject(e)||h.isArray(e)}function Wn(e){return h.endsWith(e,"[]")?e.slice(0,-2):e}function Dr(e,t,r){return e?e.concat(t).map(function(a,o){return a=Wn(a),!r&&o?"["+a+"]":a}).join(r?".":""):t}function ji(e){return h.isArray(e)&&!e.some(or)}const bi=h.toFlatObject(h,{},null,function(t){return/^is[A-Z]/.test(t)});function Ps(e,t,r){if(!h.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=h.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,_){return!h.isUndefined(_[b])});const n=r.metaTokens,a=r.visitor||u,o=r.dots,l=r.indexes,p=(r.Blob||typeof Blob<"u"&&Blob)&&h.isSpecCompliantForm(t);if(!h.isFunction(a))throw new TypeError("visitor must be a function");function i(f){if(f===null)return"";if(h.isDate(f))return f.toISOString();if(h.isBoolean(f))return f.toString();if(!p&&h.isBlob(f))throw new J("Blob is not supported. Use a Buffer instead.");return h.isArrayBuffer(f)||h.isTypedArray(f)?p&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,b,_){let E=f;if(f&&!_&&typeof f=="object"){if(h.endsWith(b,"{}"))b=n?b:b.slice(0,-2),f=JSON.stringify(f);else if(h.isArray(f)&&ji(f)||(h.isFileList(f)||h.endsWith(b,"[]"))&&(E=h.toArray(f)))return b=Wn(b),E.forEach(function(B,A){!(h.isUndefined(B)||B===null)&&t.append(l===!0?Dr([b],A,o):l===null?b:b+"[]",i(B))}),!1}return or(f)?!0:(t.append(Dr(_,b,o),i(f)),!1)}const v=[],g=Object.assign(bi,{defaultVisitor:u,convertValue:i,isVisitable:or});function w(f,b){if(!h.isUndefined(f)){if(v.indexOf(f)!==-1)throw Error("Circular reference detected in "+b.join("."));v.push(f),h.forEach(f,function(E,N){(!(h.isUndefined(E)||E===null)&&a.call(t,E,h.isString(N)?N.trim():N,b,g))===!0&&w(E,b?b.concat(N):[N])}),v.pop()}}if(!h.isObject(e))throw new TypeError("data must be an object");return w(e),t}function Br(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function gr(e,t){this._pairs=[],e&&Ps(e,this,t)}const Gn=gr.prototype;Gn.append=function(t,r){this._pairs.push([t,r])};Gn.toString=function(t){const r=t?function(n){return t.call(this,n,Br)}:Br;return this._pairs.map(function(a){return r(a[0])+"="+r(a[1])},"").join("&")};function vi(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Kn(e,t,r){if(!t)return e;const n=r&&r.encode||vi;h.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let o;if(a?o=a(t,r):o=h.isURLSearchParams(t)?t.toString():new gr(t,r).toString(n),o){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class Hr{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){h.forEach(this.handlers,function(n){n!==null&&t(n)})}}const Yn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wi=typeof URLSearchParams<"u"?URLSearchParams:gr,Si=typeof FormData<"u"?FormData:null,Ti=typeof Blob<"u"?Blob:null,Ci={isBrowser:!0,classes:{URLSearchParams:wi,FormData:Si,Blob:Ti},protocols:["http","https","file","blob","url","data"]},jr=typeof window<"u"&&typeof document<"u",lr=typeof navigator=="object"&&navigator||void 0,ki=jr&&(!lr||["ReactNative","NativeScript","NS"].indexOf(lr.product)<0),Ii=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ni=jr&&window.location.href||"http://localhost",Ri=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jr,hasStandardBrowserEnv:ki,hasStandardBrowserWebWorkerEnv:Ii,navigator:lr,origin:Ni},Symbol.toStringTag,{value:"Module"})),Te={...Ri,...Ci};function Pi(e,t){return Ps(e,new Te.classes.URLSearchParams,{visitor:function(r,n,a,o){return Te.isNode&&h.isBuffer(r)?(this.append(n,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...t})}function Ei(e){return h.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Oi(e){const t={},r=Object.keys(e);let n;const a=r.length;let o;for(n=0;n<a;n++)o=r[n],t[o]=e[o];return t}function Xn(e){function t(r,n,a,o){let l=r[o++];if(l==="__proto__")return!0;const c=Number.isFinite(+l),p=o>=r.length;return l=!l&&h.isArray(a)?a.length:l,p?(h.hasOwnProp(a,l)?a[l]=[a[l],n]:a[l]=n,!c):((!a[l]||!h.isObject(a[l]))&&(a[l]=[]),t(r,n,a[l],o)&&h.isArray(a[l])&&(a[l]=Oi(a[l])),!c)}if(h.isFormData(e)&&h.isFunction(e.entries)){const r={};return h.forEachEntry(e,(n,a)=>{t(Ei(n),a,r,0)}),r}return null}function Ai(e,t,r){if(h.isString(e))try{return(t||JSON.parse)(e),h.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Gt={transitional:Yn,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",a=n.indexOf("application/json")>-1,o=h.isObject(t);if(o&&h.isHTMLForm(t)&&(t=new FormData(t)),h.isFormData(t))return a?JSON.stringify(Xn(t)):t;if(h.isArrayBuffer(t)||h.isBuffer(t)||h.isStream(t)||h.isFile(t)||h.isBlob(t)||h.isReadableStream(t))return t;if(h.isArrayBufferView(t))return t.buffer;if(h.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Pi(t,this.formSerializer).toString();if((c=h.isFileList(t))||n.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return Ps(c?{"files[]":t}:t,p&&new p,this.formSerializer)}}return o||a?(r.setContentType("application/json",!1),Ai(t)):t}],transformResponse:[function(t){const r=this.transitional||Gt.transitional,n=r&&r.forcedJSONParsing,a=this.responseType==="json";if(h.isResponse(t)||h.isReadableStream(t))return t;if(t&&h.isString(t)&&(n&&!this.responseType||a)){const l=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(c){if(l)throw c.name==="SyntaxError"?J.from(c,J.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Te.classes.FormData,Blob:Te.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};h.forEach(["delete","get","head","post","put","patch"],e=>{Gt.headers[e]={}});const $i=h.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Li=e=>{const t={};let r,n,a;return e&&e.split(`
`).forEach(function(l){a=l.indexOf(":"),r=l.substring(0,a).trim().toLowerCase(),n=l.substring(a+1).trim(),!(!r||t[r]&&$i[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},qr=Symbol("internals");function Lt(e){return e&&String(e).trim().toLowerCase()}function ps(e){return e===!1||e==null?e:h.isArray(e)?e.map(ps):String(e)}function Fi(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const zi=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Us(e,t,r,n,a){if(h.isFunction(n))return n.call(this,t,r);if(a&&(t=r),!!h.isString(t)){if(h.isString(n))return t.indexOf(n)!==-1;if(h.isRegExp(n))return n.test(t)}}function Mi(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function Ui(e,t){const r=h.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(a,o,l){return this[n].call(this,t,a,o,l)},configurable:!0})})}let Oe=class{constructor(t){t&&this.set(t)}set(t,r,n){const a=this;function o(c,p,i){const u=Lt(p);if(!u)throw new Error("header name must be a non-empty string");const v=h.findKey(a,u);(!v||a[v]===void 0||i===!0||i===void 0&&a[v]!==!1)&&(a[v||p]=ps(c))}const l=(c,p)=>h.forEach(c,(i,u)=>o(i,u,p));if(h.isPlainObject(t)||t instanceof this.constructor)l(t,r);else if(h.isString(t)&&(t=t.trim())&&!zi(t))l(Li(t),r);else if(h.isObject(t)&&h.isIterable(t)){let c={},p,i;for(const u of t){if(!h.isArray(u))throw TypeError("Object iterator must return a key-value pair");c[i=u[0]]=(p=c[i])?h.isArray(p)?[...p,u[1]]:[p,u[1]]:u[1]}l(c,r)}else t!=null&&o(r,t,n);return this}get(t,r){if(t=Lt(t),t){const n=h.findKey(this,t);if(n){const a=this[n];if(!r)return a;if(r===!0)return Fi(a);if(h.isFunction(r))return r.call(this,a,n);if(h.isRegExp(r))return r.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Lt(t),t){const n=h.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||Us(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let a=!1;function o(l){if(l=Lt(l),l){const c=h.findKey(n,l);c&&(!r||Us(n,n[c],c,r))&&(delete n[c],a=!0)}}return h.isArray(t)?t.forEach(o):o(t),a}clear(t){const r=Object.keys(this);let n=r.length,a=!1;for(;n--;){const o=r[n];(!t||Us(this,this[o],o,t,!0))&&(delete this[o],a=!0)}return a}normalize(t){const r=this,n={};return h.forEach(this,(a,o)=>{const l=h.findKey(n,o);if(l){r[l]=ps(a),delete r[o];return}const c=t?Mi(o):String(o).trim();c!==o&&delete r[o],r[c]=ps(a),n[c]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return h.forEach(this,(n,a)=>{n!=null&&n!==!1&&(r[a]=t&&h.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[qr]=this[qr]={accessors:{}}).accessors,a=this.prototype;function o(l){const c=Lt(l);n[c]||(Ui(a,l),n[c]=!0)}return h.isArray(t)?t.forEach(o):o(t),this}};Oe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);h.reduceDescriptors(Oe.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});h.freezeMethods(Oe);function Ds(e,t){const r=this||Gt,n=t||r,a=Oe.from(n.headers);let o=n.data;return h.forEach(e,function(c){o=c.call(r,o,a.normalize(),t?t.status:void 0)}),a.normalize(),o}function Qn(e){return!!(e&&e.__CANCEL__)}function Rt(e,t,r){J.call(this,e??"canceled",J.ERR_CANCELED,t,r),this.name="CanceledError"}h.inherits(Rt,J,{__CANCEL__:!0});function Zn(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new J("Request failed with status code "+r.status,[J.ERR_BAD_REQUEST,J.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Di(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Bi(e,t){e=e||10;const r=new Array(e),n=new Array(e);let a=0,o=0,l;return t=t!==void 0?t:1e3,function(p){const i=Date.now(),u=n[o];l||(l=i),r[a]=p,n[a]=i;let v=o,g=0;for(;v!==a;)g+=r[v++],v=v%e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),i-l<t)return;const w=u&&i-u;return w?Math.round(g*1e3/w):void 0}}function Hi(e,t){let r=0,n=1e3/t,a,o;const l=(i,u=Date.now())=>{r=u,a=null,o&&(clearTimeout(o),o=null),e(...i)};return[(...i)=>{const u=Date.now(),v=u-r;v>=n?l(i,u):(a=i,o||(o=setTimeout(()=>{o=null,l(a)},n-v)))},()=>a&&l(a)]}const ms=(e,t,r=3)=>{let n=0;const a=Bi(50,250);return Hi(o=>{const l=o.loaded,c=o.lengthComputable?o.total:void 0,p=l-n,i=a(p),u=l<=c;n=l;const v={loaded:l,total:c,progress:c?l/c:void 0,bytes:p,rate:i||void 0,estimated:i&&c&&u?(c-l)/i:void 0,event:o,lengthComputable:c!=null,[t?"download":"upload"]:!0};e(v)},r)},Jr=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Vr=e=>(...t)=>h.asap(()=>e(...t)),qi=Te.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,Te.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(Te.origin),Te.navigator&&/(msie|trident)/i.test(Te.navigator.userAgent)):()=>!0,Ji=Te.hasStandardBrowserEnv?{write(e,t,r,n,a,o,l){if(typeof document>"u")return;const c=[`${e}=${encodeURIComponent(t)}`];h.isNumber(r)&&c.push(`expires=${new Date(r).toUTCString()}`),h.isString(n)&&c.push(`path=${n}`),h.isString(a)&&c.push(`domain=${a}`),o===!0&&c.push("secure"),h.isString(l)&&c.push(`SameSite=${l}`),document.cookie=c.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Vi(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Wi(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function ea(e,t,r){let n=!Vi(t);return e&&(n||r==!1)?Wi(e,t):t}const Wr=e=>e instanceof Oe?{...e}:e;function ut(e,t){t=t||{};const r={};function n(i,u,v,g){return h.isPlainObject(i)&&h.isPlainObject(u)?h.merge.call({caseless:g},i,u):h.isPlainObject(u)?h.merge({},u):h.isArray(u)?u.slice():u}function a(i,u,v,g){if(h.isUndefined(u)){if(!h.isUndefined(i))return n(void 0,i,v,g)}else return n(i,u,v,g)}function o(i,u){if(!h.isUndefined(u))return n(void 0,u)}function l(i,u){if(h.isUndefined(u)){if(!h.isUndefined(i))return n(void 0,i)}else return n(void 0,u)}function c(i,u,v){if(v in t)return n(i,u);if(v in e)return n(void 0,i)}const p={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:c,headers:(i,u,v)=>a(Wr(i),Wr(u),v,!0)};return h.forEach(Object.keys({...e,...t}),function(u){const v=p[u]||a,g=v(e[u],t[u],u);h.isUndefined(g)&&v!==c||(r[u]=g)}),r}const ta=e=>{const t=ut({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:a,xsrfCookieName:o,headers:l,auth:c}=t;if(t.headers=l=Oe.from(l),t.url=Kn(ea(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&l.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),h.isFormData(r)){if(Te.hasStandardBrowserEnv||Te.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(h.isFunction(r.getHeaders)){const p=r.getHeaders(),i=["content-type","content-length"];Object.entries(p).forEach(([u,v])=>{i.includes(u.toLowerCase())&&l.set(u,v)})}}if(Te.hasStandardBrowserEnv&&(n&&h.isFunction(n)&&(n=n(t)),n||n!==!1&&qi(t.url))){const p=a&&o&&Ji.read(o);p&&l.set(a,p)}return t},Gi=typeof XMLHttpRequest<"u",Ki=Gi&&function(e){return new Promise(function(r,n){const a=ta(e);let o=a.data;const l=Oe.from(a.headers).normalize();let{responseType:c,onUploadProgress:p,onDownloadProgress:i}=a,u,v,g,w,f;function b(){w&&w(),f&&f(),a.cancelToken&&a.cancelToken.unsubscribe(u),a.signal&&a.signal.removeEventListener("abort",u)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function E(){if(!_)return;const B=Oe.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),re={data:!c||c==="text"||c==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:B,config:e,request:_};Zn(function(K){r(K),b()},function(K){n(K),b()},re),_=null}"onloadend"in _?_.onloadend=E:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(E)},_.onabort=function(){_&&(n(new J("Request aborted",J.ECONNABORTED,e,_)),_=null)},_.onerror=function(A){const re=A&&A.message?A.message:"Network Error",O=new J(re,J.ERR_NETWORK,e,_);O.event=A||null,n(O),_=null},_.ontimeout=function(){let A=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const re=a.transitional||Yn;a.timeoutErrorMessage&&(A=a.timeoutErrorMessage),n(new J(A,re.clarifyTimeoutError?J.ETIMEDOUT:J.ECONNABORTED,e,_)),_=null},o===void 0&&l.setContentType(null),"setRequestHeader"in _&&h.forEach(l.toJSON(),function(A,re){_.setRequestHeader(re,A)}),h.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),c&&c!=="json"&&(_.responseType=a.responseType),i&&([g,f]=ms(i,!0),_.addEventListener("progress",g)),p&&_.upload&&([v,w]=ms(p),_.upload.addEventListener("progress",v),_.upload.addEventListener("loadend",w)),(a.cancelToken||a.signal)&&(u=B=>{_&&(n(!B||B.type?new Rt(null,e,_):B),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(u),a.signal&&(a.signal.aborted?u():a.signal.addEventListener("abort",u)));const N=Di(a.url);if(N&&Te.protocols.indexOf(N)===-1){n(new J("Unsupported protocol "+N+":",J.ERR_BAD_REQUEST,e));return}_.send(o||null)})},Yi=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,a;const o=function(i){if(!a){a=!0,c();const u=i instanceof Error?i:this.reason;n.abort(u instanceof J?u:new Rt(u instanceof Error?u.message:u))}};let l=t&&setTimeout(()=>{l=null,o(new J(`timeout ${t} of ms exceeded`,J.ETIMEDOUT))},t);const c=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(i=>{i.unsubscribe?i.unsubscribe(o):i.removeEventListener("abort",o)}),e=null)};e.forEach(i=>i.addEventListener("abort",o));const{signal:p}=n;return p.unsubscribe=()=>h.asap(c),p}},Xi=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,a;for(;n<r;)a=n+t,yield e.slice(n,a),n=a},Qi=async function*(e,t){for await(const r of Zi(e))yield*Xi(r,t)},Zi=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},Gr=(e,t,r,n)=>{const a=Qi(e,t);let o=0,l,c=p=>{l||(l=!0,n&&n(p))};return new ReadableStream({async pull(p){try{const{done:i,value:u}=await a.next();if(i){c(),p.close();return}let v=u.byteLength;if(r){let g=o+=v;r(g)}p.enqueue(new Uint8Array(u))}catch(i){throw c(i),i}},cancel(p){return c(p),a.return()}},{highWaterMark:2})},Kr=64*1024,{isFunction:ns}=h,ec=(({Request:e,Response:t})=>({Request:e,Response:t}))(h.global),{ReadableStream:Yr,TextEncoder:Xr}=h.global,Qr=(e,...t)=>{try{return!!e(...t)}catch{return!1}},tc=e=>{e=h.merge.call({skipUndefined:!0},ec,e);const{fetch:t,Request:r,Response:n}=e,a=t?ns(t):typeof fetch=="function",o=ns(r),l=ns(n);if(!a)return!1;const c=a&&ns(Yr),p=a&&(typeof Xr=="function"?(f=>b=>f.encode(b))(new Xr):async f=>new Uint8Array(await new r(f).arrayBuffer())),i=o&&c&&Qr(()=>{let f=!1;const b=new r(Te.origin,{body:new Yr,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!b}),u=l&&c&&Qr(()=>h.isReadableStream(new n("").body)),v={stream:u&&(f=>f.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!v[f]&&(v[f]=(b,_)=>{let E=b&&b[f];if(E)return E.call(b);throw new J(`Response type '${f}' is not supported`,J.ERR_NOT_SUPPORT,_)})});const g=async f=>{if(f==null)return 0;if(h.isBlob(f))return f.size;if(h.isSpecCompliantForm(f))return(await new r(Te.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(h.isArrayBufferView(f)||h.isArrayBuffer(f))return f.byteLength;if(h.isURLSearchParams(f)&&(f=f+""),h.isString(f))return(await p(f)).byteLength},w=async(f,b)=>{const _=h.toFiniteNumber(f.getContentLength());return _??g(b)};return async f=>{let{url:b,method:_,data:E,signal:N,cancelToken:B,timeout:A,onDownloadProgress:re,onUploadProgress:O,responseType:K,headers:X,withCredentials:R="same-origin",fetchOptions:D}=ta(f),ee=t||fetch;K=K?(K+"").toLowerCase():"text";let F=Yi([N,B&&B.toAbortSignal()],A),ae=null;const de=F&&F.unsubscribe&&(()=>{F.unsubscribe()});let _e;try{if(O&&i&&_!=="get"&&_!=="head"&&(_e=await w(X,E))!==0){let je=new r(b,{method:"POST",body:E,duplex:"half"}),Ce;if(h.isFormData(E)&&(Ce=je.headers.get("content-type"))&&X.setContentType(Ce),je.body){const[Me,ue]=Jr(_e,ms(Vr(O)));E=Gr(je.body,Kr,Me,ue)}}h.isString(R)||(R=R?"include":"omit");const S=o&&"credentials"in r.prototype,te={...D,signal:F,method:_.toUpperCase(),headers:X.normalize().toJSON(),body:E,duplex:"half",credentials:S?R:void 0};ae=o&&new r(b,te);let ie=await(o?ee(ae,D):ee(b,te));const ye=u&&(K==="stream"||K==="response");if(u&&(re||ye&&de)){const je={};["status","statusText","headers"].forEach(Ge=>{je[Ge]=ie[Ge]});const Ce=h.toFiniteNumber(ie.headers.get("content-length")),[Me,ue]=re&&Jr(Ce,ms(Vr(re),!0))||[];ie=new n(Gr(ie.body,Kr,Me,()=>{ue&&ue(),de&&de()}),je)}K=K||"text";let ge=await v[h.findKey(v,K)||"text"](ie,f);return!ye&&de&&de(),await new Promise((je,Ce)=>{Zn(je,Ce,{data:ge,headers:Oe.from(ie.headers),status:ie.status,statusText:ie.statusText,config:f,request:ae})})}catch(S){throw de&&de(),S&&S.name==="TypeError"&&/Load failed|fetch/i.test(S.message)?Object.assign(new J("Network Error",J.ERR_NETWORK,f,ae),{cause:S.cause||S}):J.from(S,S&&S.code,f,ae)}}},sc=new Map,sa=e=>{let t=e&&e.env||{};const{fetch:r,Request:n,Response:a}=t,o=[n,a,r];let l=o.length,c=l,p,i,u=sc;for(;c--;)p=o[c],i=u.get(p),i===void 0&&u.set(p,i=c?new Map:tc(t)),u=i;return i};sa();const br={http:gi,xhr:Ki,fetch:{get:sa}};h.forEach(br,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Zr=e=>`- ${e}`,rc=e=>h.isFunction(e)||e===null||e===!1;function nc(e,t){e=h.isArray(e)?e:[e];const{length:r}=e;let n,a;const o={};for(let l=0;l<r;l++){n=e[l];let c;if(a=n,!rc(n)&&(a=br[(c=String(n)).toLowerCase()],a===void 0))throw new J(`Unknown adapter '${c}'`);if(a&&(h.isFunction(a)||(a=a.get(t))))break;o[c||"#"+l]=a}if(!a){const l=Object.entries(o).map(([p,i])=>`adapter ${p} `+(i===!1?"is not supported by the environment":"is not available in the build"));let c=r?l.length>1?`since :
`+l.map(Zr).join(`
`):" "+Zr(l[0]):"as no adapter specified";throw new J("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return a}const ra={getAdapter:nc,adapters:br};function Bs(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Rt(null,e)}function en(e){return Bs(e),e.headers=Oe.from(e.headers),e.data=Ds.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),ra.getAdapter(e.adapter||Gt.adapter,e)(e).then(function(n){return Bs(e),n.data=Ds.call(e,e.transformResponse,n),n.headers=Oe.from(n.headers),n},function(n){return Qn(n)||(Bs(e),n&&n.response&&(n.response.data=Ds.call(e,e.transformResponse,n.response),n.response.headers=Oe.from(n.response.headers))),Promise.reject(n)})}const na="1.13.1",Es={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Es[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const tn={};Es.transitional=function(t,r,n){function a(o,l){return"[Axios v"+na+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,c)=>{if(t===!1)throw new J(a(l," has been removed"+(r?" in "+r:"")),J.ERR_DEPRECATED);return r&&!tn[l]&&(tn[l]=!0,console.warn(a(l," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(o,l,c):!0}};Es.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function ac(e,t,r){if(typeof e!="object")throw new J("options must be an object",J.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const o=n[a],l=t[o];if(l){const c=e[o],p=c===void 0||l(c,o,e);if(p!==!0)throw new J("option "+o+" must be "+p,J.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new J("Unknown option "+o,J.ERR_BAD_OPTION)}}const fs={assertOptions:ac,validators:Es},qe=fs.validators;let dt=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Hr,response:new Hr}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=ut(this.defaults,r);const{transitional:n,paramsSerializer:a,headers:o}=r;n!==void 0&&fs.assertOptions(n,{silentJSONParsing:qe.transitional(qe.boolean),forcedJSONParsing:qe.transitional(qe.boolean),clarifyTimeoutError:qe.transitional(qe.boolean)},!1),a!=null&&(h.isFunction(a)?r.paramsSerializer={serialize:a}:fs.assertOptions(a,{encode:qe.function,serialize:qe.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),fs.assertOptions(r,{baseUrl:qe.spelling("baseURL"),withXsrfToken:qe.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let l=o&&h.merge(o.common,o[r.method]);o&&h.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),r.headers=Oe.concat(l,o);const c=[];let p=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(r)===!1||(p=p&&b.synchronous,c.unshift(b.fulfilled,b.rejected))});const i=[];this.interceptors.response.forEach(function(b){i.push(b.fulfilled,b.rejected)});let u,v=0,g;if(!p){const f=[en.bind(this),void 0];for(f.unshift(...c),f.push(...i),g=f.length,u=Promise.resolve(r);v<g;)u=u.then(f[v++],f[v++]);return u}g=c.length;let w=r;for(;v<g;){const f=c[v++],b=c[v++];try{w=f(w)}catch(_){b.call(this,_);break}}try{u=en.call(this,w)}catch(f){return Promise.reject(f)}for(v=0,g=i.length;v<g;)u=u.then(i[v++],i[v++]);return u}getUri(t){t=ut(this.defaults,t);const r=ea(t.baseURL,t.url,t.allowAbsoluteUrls);return Kn(r,t.params,t.paramsSerializer)}};h.forEach(["delete","get","head","options"],function(t){dt.prototype[t]=function(r,n){return this.request(ut(n||{},{method:t,url:r,data:(n||{}).data}))}});h.forEach(["post","put","patch"],function(t){function r(n){return function(o,l,c){return this.request(ut(c||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:l}))}}dt.prototype[t]=r(),dt.prototype[t+"Form"]=r(!0)});let oc=class aa{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const n=this;this.promise.then(a=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](a);n._listeners=null}),this.promise.then=a=>{let o;const l=new Promise(c=>{n.subscribe(c),o=c}).then(a);return l.cancel=function(){n.unsubscribe(o)},l},t(function(o,l,c){n.reason||(n.reason=new Rt(o,l,c),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new aa(function(a){t=a}),cancel:t}}};function lc(e){return function(r){return e.apply(null,r)}}function ic(e){return h.isObject(e)&&e.isAxiosError===!0}const ir={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(ir).forEach(([e,t])=>{ir[t]=e});function oa(e){const t=new dt(e),r=Fn(dt.prototype.request,t);return h.extend(r,dt.prototype,t,{allOwnKeys:!0}),h.extend(r,t,null,{allOwnKeys:!0}),r.create=function(a){return oa(ut(e,a))},r}const ve=oa(Gt);ve.Axios=dt;ve.CanceledError=Rt;ve.CancelToken=oc;ve.isCancel=Qn;ve.VERSION=na;ve.toFormData=Ps;ve.AxiosError=J;ve.Cancel=ve.CanceledError;ve.all=function(t){return Promise.all(t)};ve.spread=lc;ve.isAxiosError=ic;ve.mergeConfig=ut;ve.AxiosHeaders=Oe;ve.formToJSON=e=>Xn(h.isHTMLForm(e)?new FormData(e):e);ve.getAdapter=ra.getAdapter;ve.HttpStatusCode=ir;ve.default=ve;const{Axios:yp,AxiosError:_p,CanceledError:gp,isCancel:jp,CancelToken:bp,VERSION:vp,all:wp,Cancel:Sp,isAxiosError:Tp,spread:Cp,toFormData:kp,AxiosHeaders:Ip,HttpStatusCode:Np,formToJSON:Rp,getAdapter:Pp,mergeConfig:Ep}=ve,cc="http://127.0.0.1:8801",dc=e=>{var t,r,n,a;if("type"in e)switch(e.type){case"auto_retry":return{kind:"auto_retry",extra_attempts:e.extra_attempts??0};case"annotate":return{kind:"annotate",severity:e.severity,note:e.note};case"human_approval":return{kind:"human_approval",severity:e.severity};default:return{kind:"annotate"}}return"auto_retry"in e?{kind:"auto_retry",extra_attempts:((t=e.auto_retry)==null?void 0:t.extra_attempts)??0}:"annotate"in e?{kind:"annotate",severity:(r=e.annotate)==null?void 0:r.severity,note:(n=e.annotate)==null?void 0:n.note}:"human_approval"in e?{kind:"human_approval",severity:(a=e.human_approval)==null?void 0:a.severity}:{kind:"annotate"}},uc=e=>({id:e.id,description:e.description,enabled:e.enabled,tags:e.tags??[],telemetry_label:e.telemetry_label??void 0,action:dc(e.action)});class pc{constructor(t=cc){zs(this,"client");zs(this,"baseURL");this.baseURL=t,this.client=ve.create({baseURL:t||void 0,timeout:6e4,headers:{"Content-Type":"application/json"}})}setBaseUrl(t){this.baseURL=t,this.client.defaults.baseURL=t||void 0}getBaseUrl(){return this.baseURL}async perceive(t){return(await this.client.post("/api/perceive",t)).data}async getPerceptionMetrics(){return(await this.client.get("/api/perceive/metrics")).data.metrics}async chat(t){return(await this.client.post("/api/chat",t)).data}async listTasks(t){return(await this.client.get("/api/tasks",{params:t?{limit:t}:void 0})).data.tasks}async getTask(t,r){return(await this.client.get(`/api/tasks/${t}`,{params:r?{limit:r}:void 0})).data}async getTaskStatus(t){return(await this.client.get(`/api/tasks/${t}/status`)).data.status}async getTaskLogs(t,r){return(await this.client.get(`/api/tasks/${t}/logs`,{params:r?{since:r}:void 0})).data.logs}async getTaskObservations(t,r){return(await this.client.get(`/api/tasks/${t}/observations`,{params:r?{limit:r}:void 0})).data}async listRecordings(t,r){return(await this.client.get("/api/recordings",{params:{...t?{limit:t}:{},...r?{state:r}:{}}})).data}async getRecording(t){return(await this.client.get(`/api/recordings/${t}`)).data}async getTaskArtifacts(t){return(await this.client.get(`/api/tasks/${t}/artifacts`)).data}async getTaskAnnotations(t){return(await this.client.get(`/api/tasks/${t}/annotations`)).data.annotations}async createTaskAnnotation(t,r){return(await this.client.post(`/api/tasks/${t}/annotations`,r)).data.annotation}async downloadTaskArtifact(t,r){return(await this.client.get(`/api/tasks/${t}/artifacts/${encodeURIComponent(r)}`,{responseType:"blob"})).data}openTaskStream(t){const r=this.baseURL||window.location.origin,n=new URL(r);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.pathname=`/api/tasks/${t}/stream`,n.search="",n.hash="",new WebSocket(n.toString())}async executeTask(t,r){return(await this.client.post(`/api/tasks/${t}/execute`,r??{})).data}async cancelTask(t,r){return(await this.client.post(`/api/tasks/${t}/cancel`,{reason:r})).data}async createTask(t){return(await this.client.post("/api/tasks",t)).data}async listMemoryRecords(t){return(await this.client.get("/api/memory",{params:t})).data.records}async createMemoryRecord(t){const r=await this.client.post("/api/memory",t);if(!r.data.success||!r.data.record)throw new Error(r.data.error||"Failed to store memory record");return r.data.record}async deleteMemoryRecord(t){const r=await this.client.delete(`/api/memory/${t}`);if(!r.data.success)throw new Error(r.data.error||"Failed to delete memory record")}async updateMemoryRecord(t,r){const n=await this.client.put(`/api/memory/${t}`,r);if(!n.data.success||!n.data.record)throw new Error(n.data.error||"Failed to update memory record");return n.data.record}async getMemoryStats(){const t=await this.client.get("/api/memory/stats");if(!t.data.success)throw new Error("Failed to fetch memory stats");return t.data.stats}async listSelfHealStrategies(){const t=await this.client.get("/api/self-heal/strategies");if(!t.data.success)throw new Error(t.data.error||"Failed to load self-heal strategies");return t.data.strategies.map(uc)}async setSelfHealStrategyEnabled(t,r){const n=await this.client.post(`/api/self-heal/strategies/${t}`,{enabled:r});if(!n.data.success)throw new Error(n.data.error||"Failed to update strategy")}async getGovernanceOverview(){const t=await this.client.get("/api/governance/overview");if(!t.data.success)throw new Error(t.data.error||"Failed to load governance overview");return{policy:t.data.policy,policy_files:t.data.policy_files,plugins:t.data.plugins,alerts:t.data.alerts}}async runGatewayPlan(t){const r={...t.plan};"overlays"in r&&delete r.overlays;const n=t.current_url?{current_url:t.current_url}:void 0,a=await this.client.post("/v1/tasks/run",{plan:r,prompt:t.prompt,constraints:t.constraints??[],context:n});if(!a.data.success)throw new Error(a.data.error||"Gateway 执行失败");return{success:a.data.success,task_id:a.data.task_id,stream_path:a.data.stream_path}}async health(){return(await this.client.get("/health")).data}}const Q=new pc,Hs=Q.getBaseUrl(),sn=e=>e.replace(/\/+$/,"").toLowerCase(),rn=new Set(["","http://127.0.0.1:8788","http://localhost:8788","http://0.0.0.0:8788","http://127.0.0.1:8800","http://localhost:8800","http://0.0.0.0:8800"]),la=Ln()(Ol(e=>({baseUrl:Hs,status:"unknown",lastChecked:void 0,setBaseUrl:t=>{const r=t.trim();Q.setBaseUrl(r),e({baseUrl:r,status:"unknown"})},setStatus:(t,r)=>e(n=>({status:t,lastChecked:t==="online"||t==="offline"?r??new Date().toISOString():n.lastChecked}))}),{name:"soulbrowser-backend-config",version:3,migrate:(e,t)=>{const r=e;if(!r)return r;const n=sn(r.baseUrl??"");return rn.has(n)?{...r,baseUrl:Hs}:r},partialize:e=>({baseUrl:e.baseUrl}),onRehydrateStorage:()=>e=>{if(!e)return;const t=sn(e.baseUrl??"");if(rn.has(t)){e.setBaseUrl(Hs);return}e.baseUrl&&Q.setBaseUrl(e.baseUrl)}})),{Header:fc,Sider:hc,Content:mc}=sr;function xc(){const e=Fa(),t=za(),[r,n]=y.useState(!1),{baseUrl:a,status:o,lastChecked:l,setStatus:c}=la();y.useEffect(()=>{let u=!1;const v=async()=>{c("checking");try{await Q.health(),u||c("online")}catch{u||c("offline")}};v();const g=setInterval(v,6e4);return()=>{u=!0,clearInterval(g)}},[a,c]);const p={online:{color:"success",icon:s.jsx(yn,{}),text:"API 在线"},checking:{color:"processing",icon:s.jsx(Or,{spin:!0}),text:"检测中..."},offline:{color:"error",icon:s.jsx(qa,{}),text:"API 未连接"},unknown:{color:"default",icon:s.jsx(Or,{}),text:"等待检测"}}[o],i=[{key:"/chat",icon:s.jsx(Ja,{}),label:"AI 对话"},{key:"/perceive",icon:s.jsx(hs,{}),label:"页面感知"},{key:"/tasks",icon:s.jsx(Va,{}),label:"任务中心"},{key:"/diagnostics",icon:s.jsx(mr,{}),label:"接口诊断"},{key:"/governance",icon:s.jsx(Ft,{}),label:"治理中心"}];return s.jsxs(sr,{className:Ve.layout,children:[s.jsxs(fc,{className:Ve.header,children:[s.jsxs("div",{className:Ve.logo,children:[s.jsx("span",{className:Ve.logoIcon,children:"🤖"}),s.jsx("span",{className:Ve.logoText,children:"SoulBrowser Console"})]}),s.jsxs("div",{className:Ve.headerRight,children:[s.jsx(xn,{title:s.jsxs("div",{children:[s.jsxs("div",{children:["目标：",a||"当前域名"]}),l&&s.jsxs("div",{children:["最近检测：",We(l).format("HH:mm:ss")]})]}),children:s.jsx(q,{icon:p.icon,color:p.color,children:p.text})}),s.jsx("span",{className:Ve.version,style:{marginLeft:"12px"},children:"v1.0.0"})]})]}),s.jsxs(sr,{children:[s.jsx(hc,{collapsible:!0,collapsed:r,onCollapse:n,theme:"dark",width:200,className:Ve.sider,children:s.jsx(Ha,{mode:"inline",selectedKeys:[t.pathname],items:i,onClick:({key:u})=>e(u),theme:"dark"})}),s.jsx(mc,{className:Ve.content,children:s.jsx(Ma,{})})]})]})}var ia=Symbol.for("immer-nothing"),nn=Symbol.for("immer-draftable"),Fe=Symbol.for("immer-state");function De(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Ut=Object.getPrototypeOf;function It(e){return!!e&&!!e[Fe]}function pt(e){var t;return e?ca(e)||Array.isArray(e)||!!e[nn]||!!((t=e.constructor)!=null&&t[nn])||Kt(e)||As(e):!1}var yc=Object.prototype.constructor.toString(),an=new WeakMap;function ca(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);if(t===null||t===Object.prototype)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(r===Object)return!0;if(typeof r!="function")return!1;let n=an.get(r);return n===void 0&&(n=Function.toString.call(r),an.set(r,n)),n===yc}function xs(e,t,r=!0){Os(e)===0?(r?Reflect.ownKeys(e):Object.keys(e)).forEach(a=>{t(a,e[a],e)}):e.forEach((n,a)=>t(a,n,e))}function Os(e){const t=e[Fe];return t?t.type_:Array.isArray(e)?1:Kt(e)?2:As(e)?3:0}function cr(e,t){return Os(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function da(e,t,r){const n=Os(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function _c(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Kt(e){return e instanceof Map}function As(e){return e instanceof Set}function lt(e){return e.copy_||e.base_}function dr(e,t){if(Kt(e))return new Map(e);if(As(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=ca(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[Fe];let a=Reflect.ownKeys(n);for(let o=0;o<a.length;o++){const l=a[o],c=n[l];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(n[l]={configurable:!0,writable:!0,enumerable:c.enumerable,value:e[l]})}return Object.create(Ut(e),n)}else{const n=Ut(e);if(n!==null&&r)return{...e};const a=Object.create(n);return Object.assign(a,e)}}function vr(e,t=!1){return $s(e)||It(e)||!pt(e)||(Os(e)>1&&Object.defineProperties(e,{set:as,add:as,clear:as,delete:as}),Object.freeze(e),t&&Object.values(e).forEach(r=>vr(r,!0))),e}function gc(){De(2)}var as={value:gc};function $s(e){return e===null||typeof e!="object"?!0:Object.isFrozen(e)}var jc={};function ft(e){const t=jc[e];return t||De(0,e),t}var Dt;function ua(){return Dt}function bc(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function on(e,t){t&&(ft("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ur(e){pr(e),e.drafts_.forEach(vc),e.drafts_=null}function pr(e){e===Dt&&(Dt=e.parent_)}function ln(e){return Dt=bc(Dt,e)}function vc(e){const t=e[Fe];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function cn(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[Fe].modified_&&(ur(t),De(4)),pt(e)&&(e=ys(t,e),t.parent_||_s(t,e)),t.patches_&&ft("Patches").generateReplacementPatches_(r[Fe].base_,e,t.patches_,t.inversePatches_)):e=ys(t,r,[]),ur(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ia?e:void 0}function ys(e,t,r){if($s(t))return t;const n=e.immer_.shouldUseStrictIteration(),a=t[Fe];if(!a)return xs(t,(o,l)=>dn(e,a,t,o,l,r),n),t;if(a.scope_!==e)return t;if(!a.modified_)return _s(e,a.base_,!0),a.base_;if(!a.finalized_){a.finalized_=!0,a.scope_.unfinalizedDrafts_--;const o=a.copy_;let l=o,c=!1;a.type_===3&&(l=new Set(o),o.clear(),c=!0),xs(l,(p,i)=>dn(e,a,o,p,i,r,c),n),_s(e,o,!1),r&&e.patches_&&ft("Patches").generatePatches_(a,r,e.patches_,e.inversePatches_)}return a.copy_}function dn(e,t,r,n,a,o,l){if(a==null||typeof a!="object"&&!l)return;const c=$s(a);if(!(c&&!l)){if(It(a)){const p=o&&t&&t.type_!==3&&!cr(t.assigned_,n)?o.concat(n):void 0,i=ys(e,a,p);if(da(r,n,i),It(i))e.canAutoFreeze_=!1;else return}else l&&r.add(a);if(pt(a)&&!c){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||t&&t.base_&&t.base_[n]===a&&c)return;ys(e,a),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&(Kt(r)?r.has(n):Object.prototype.propertyIsEnumerable.call(r,n))&&_s(e,a)}}}function _s(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&vr(t,r)}function wc(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:ua(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=n,o=wr;r&&(a=[n],o=Bt);const{revoke:l,proxy:c}=Proxy.revocable(a,o);return n.draft_=c,n.revoke_=l,c}var wr={get(e,t){if(t===Fe)return e;const r=lt(e);if(!cr(r,t))return Sc(e,r,t);const n=r[t];return e.finalized_||!pt(n)?n:n===qs(e.base_,t)?(Js(e),e.copy_[t]=hr(n,e)):n},has(e,t){return t in lt(e)},ownKeys(e){return Reflect.ownKeys(lt(e))},set(e,t,r){const n=pa(lt(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const a=qs(lt(e),t),o=a==null?void 0:a[Fe];if(o&&o.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(_c(r,a)&&(r!==void 0||cr(e.base_,t)))return!0;Js(e),fr(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return qs(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,Js(e),fr(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=lt(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){De(11)},getPrototypeOf(e){return Ut(e.base_)},setPrototypeOf(){De(12)}},Bt={};xs(wr,(e,t)=>{Bt[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Bt.deleteProperty=function(e,t){return Bt.set.call(this,e,t,void 0)};Bt.set=function(e,t,r){return wr.set.call(this,e[0],t,r,e[0])};function qs(e,t){const r=e[Fe];return(r?lt(r):e)[t]}function Sc(e,t,r){var a;const n=pa(t,r);return n?"value"in n?n.value:(a=n.get)==null?void 0:a.call(e.draft_):void 0}function pa(e,t){if(!(t in e))return;let r=Ut(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Ut(r)}}function fr(e){e.modified_||(e.modified_=!0,e.parent_&&fr(e.parent_))}function Js(e){e.copy_||(e.copy_=dr(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Tc=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const o=r;r=t;const l=this;return function(p=o,...i){return l.produce(p,u=>r.call(this,u,...i))}}typeof r!="function"&&De(6),n!==void 0&&typeof n!="function"&&De(7);let a;if(pt(t)){const o=ln(this),l=hr(t,void 0);let c=!0;try{a=r(l),c=!1}finally{c?ur(o):pr(o)}return on(o,n),cn(a,o)}else if(!t||typeof t!="object"){if(a=r(t),a===void 0&&(a=t),a===ia&&(a=void 0),this.autoFreeze_&&vr(a,!0),n){const o=[],l=[];ft("Patches").generateReplacementPatches_(t,a,o,l),n(o,l)}return a}else De(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(l,...c)=>this.produceWithPatches(l,p=>t(p,...c));let n,a;return[this.produce(t,r,(l,c)=>{n=l,a=c}),n,a]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),typeof(e==null?void 0:e.useStrictIteration)=="boolean"&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){pt(e)||De(8),It(e)&&(e=Cc(e));const t=ln(this),r=hr(e,void 0);return r[Fe].isManual_=!0,pr(t),r}finishDraft(e,t){const r=e&&e[Fe];(!r||!r.isManual_)&&De(9);const{scope_:n}=r;return on(n,t),cn(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const a=t[r];if(a.path.length===0&&a.op==="replace"){e=a.value;break}}r>-1&&(t=t.slice(r+1));const n=ft("Patches").applyPatches_;return It(e)?n(e,t):this.produce(e,a=>n(a,t))}};function hr(e,t){const r=Kt(e)?ft("MapSet").proxyMap_(e,t):As(e)?ft("MapSet").proxySet_(e,t):wc(e,t);return(t?t.scope_:ua()).drafts_.push(r),r}function Cc(e){return It(e)||De(10,e),fa(e)}function fa(e){if(!pt(e)||$s(e))return e;const t=e[Fe];let r,n=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=dr(e,t.scope_.immer_.useStrictShallowCopy_),n=t.scope_.immer_.shouldUseStrictIteration()}else r=dr(e,!0);return xs(r,(a,o)=>{da(r,a,fa(o))},n),t&&(t.finalized_=!1),r}var kc=new Tc,Ic=kc.produce;const Nc=e=>(t,r,n)=>(n.setState=(a,o,...l)=>{const c=typeof a=="function"?Ic(a):a;return t(c,o,...l)},e(n.setState,r,n)),Rc=Nc;let Pc=0;const Ec=Ln()(Rc(e=>({messages:[],isTyping:!1,currentPlan:null,addMessage:t=>e(r=>{const n={...t,id:`msg-${++Pc}`,timestamp:new Date};r.messages.push(n)}),clearMessages:()=>e(t=>{t.messages=[],t.currentPlan=null}),setTyping:t=>e(r=>{r.isTyping=t}),setCurrentPlan:t=>e(r=>{r.currentPlan=t})}))),Oc="_card_1kms7_1",Ac="_templateItem_1kms7_7",$c="_templateIcon_1kms7_20",Lc="_templateContent_1kms7_33",Fc="_templateTitle_1kms7_38",zc="_templateDescription_1kms7_44",Mc="_templateTags_1kms7_50",Uc="_createCustom_1kms7_56",Ze={card:Oc,templateItem:Ac,templateIcon:$c,templateContent:Lc,templateTitle:Fc,templateDescription:zc,templateTags:Mc,createCustom:Uc},Dc=[{id:"form-fill",title:"表单自动填写",description:"自动填写网页表单",icon:s.jsx(Wa,{}),prompt:'帮我填写 example.com 的联系表单，姓名填 "张三"，邮箱填 "zhangsan@example.com"',tags:["表单","常用"]},{id:"data-scraping",title:"网页数据采集",description:"从网页提取数据",icon:s.jsx(Ga,{}),prompt:"从 example.com 采集产品列表，包括产品名称、价格和图片链接",tags:["采集","数据"]},{id:"auto-test",title:"自动化测试",description:"执行自动化测试流程",icon:s.jsx(Ka,{}),prompt:'测试 example.com 的登录功能，使用用户名 "test" 和密码 "123456"',tags:["测试","质量"]},{id:"monitoring",title:"竞品监控",description:"监控竞品价格变化",icon:s.jsx(Ya,{}),prompt:"监控 competitor.com 的产品价格，每天检查一次并报告变化",tags:["监控","定时"]}];function Bc({onSelect:e}){return s.jsxs(he,{title:"任务模板",className:Ze.card,children:[s.jsx(G,{dataSource:Dc,renderItem:t=>s.jsxs(G.Item,{className:Ze.templateItem,onClick:()=>e(t.prompt),children:[s.jsx("div",{className:Ze.templateIcon,children:t.icon}),s.jsxs("div",{className:Ze.templateContent,children:[s.jsx("div",{className:Ze.templateTitle,children:t.title}),s.jsx("div",{className:Ze.templateDescription,children:t.description}),s.jsx("div",{className:Ze.templateTags,children:t.tags.map(r=>s.jsx(q,{children:r},r))})]})]})}),s.jsxs("div",{className:Ze.createCustom,onClick:()=>e(""),children:[s.jsx(_n,{}),s.jsx("span",{children:"自定义任务"})]})]})}const Hc="_chatPage_1b1uf_1",qc="_sidebar_1b1uf_7",Jc="_chatContainer_1b1uf_12",Vc="_messages_1b1uf_19",Wc="_welcome_1b1uf_28",Gc="_message_1b1uf_19",Kc="_userMessage_1b1uf_50",Yc="_messageAvatar_1b1uf_54",Xc="_messageContent_1b1uf_71",Qc="_messageText_1b1uf_83",Zc="_taskPlanCard_1b1uf_97",ed="_suggestions_1b1uf_101",td="_planActions_1b1uf_105",sd="_planHint_1b1uf_112",rd="_typingText_1b1uf_117",nd="_inputArea_1b1uf_122",ad="_inputCard_1b1uf_126",od="_plannerControls_1b1uf_131",ld="_helperText_1b1uf_135",id="_textarea_1b1uf_140",cd="_inputActions_1b1uf_151",ce={chatPage:Hc,sidebar:qc,chatContainer:Jc,messages:Vc,welcome:Wc,message:Gc,userMessage:Kc,messageAvatar:Yc,messageContent:Xc,messageText:Qc,taskPlanCard:Zc,suggestions:ed,planActions:td,planHint:sd,typingText:rd,inputArea:nd,inputCard:ad,plannerControls:od,helperText:ld,textarea:id,inputActions:cd},{TextArea:dd}=xe,{Paragraph:un}=I,ud=[{label:"LLM 计划器",value:"llm"},{label:"规则计划器",value:"rule"}],pd=[{label:"OpenAI",value:"openai"},{label:"Claude",value:"claude"},{label:"Mock (测试)",value:"mock"}],Vs=e=>{var r,n;if(!((r=e==null?void 0:e.tool)!=null&&r.kind))return!1;const t=e.tool.kind;return"Custom"in t?((n=t.Custom)==null?void 0:n.name)==="agent.note":!1};function fd(){const[e,t]=y.useState(""),[r,n]=y.useState("llm"),[a,o]=y.useState("openai"),[l,c]=y.useState("gpt-4o-mini"),[p,i]=y.useState(""),u=y.useRef(null),{messages:v,isTyping:g,addMessage:w,setTyping:f,setCurrentPlan:b}=Ec(),_=()=>{var O;(O=u.current)==null||O.scrollIntoView({behavior:"smooth"})};y.useEffect(()=>{_()},[v]);const E=async()=>{var K,X,R,D;if(!e.trim())return;w({role:"user",content:e}),f(!0);const O=e;t(""),i(O);try{const ee={prompt:O,execute:!1,planner:r};if(r==="llm"){if(!l.trim()){P.warning("请填写 LLM 模型名称"),f(!1);return}ee.llm_provider=a,ee.llm_model=l.trim()}const F=await Q.chat(ee);if(f(!1),F.success&&F.plan){const ae=((X=(K=F.plan)==null?void 0:K.plan)==null?void 0:X.steps)??[],de=ae.filter(te=>!Vs(te)),_e=de.length?`已生成 ${ae.length} 个步骤（其中 ${de.length} 个可自动执行），请查看详情。`:"未检测到可执行步骤，建议补充更详细的操作描述或切换为 LLM 计划器。",S=de.length?void 0:["补充更具体的页面元素和操作","切换 Planner 为 LLM 并指定模型"];w({role:"assistant",content:_e,taskPlan:F.plan,suggestions:S}),b(F.plan)}else w({role:"assistant",content:F.stderr||"抱歉，无法生成任务计划。请检查输入或稍后重试。"})}catch(ee){f(!1);const F=((D=(R=ee==null?void 0:ee.response)==null?void 0:R.data)==null?void 0:D.error)||"请确认后端服务已启动且 API Key 可用";w({role:"assistant",content:`抱歉，服务暂时不可用。${F}`}),P.error("请先启动后端服务: cargo run -- --metrics-port 0 serve --port 8801")}},N=O=>{O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),E())},B=O=>{t(O)},A=async()=>{var O,K,X;if(!p.trim()){P.warning("请先提交任务描述");return}try{const R={prompt:p,planner:r,execute:!0,max_replans:r==="llm"?1:0};r==="llm"&&(R.llm_provider=a,R.llm_model=l.trim());const D=await Q.createTask(R);D.success?P.success("任务已创建并开始执行，可在“任务中心”查看进度"):P.error(((O=D.stderr)==null?void 0:O.join(`
`))||"创建任务失败")}catch(R){P.error(((X=(K=R==null?void 0:R.response)==null?void 0:K.data)==null?void 0:X.error)||"创建任务失败，请检查后端日志")}},re=O=>{var X,R;const K=((X=O==null?void 0:O.plan)==null?void 0:X.steps)??[];return s.jsxs(he,{title:s.jsxs(L,{children:[s.jsx("span",{children:"任务计划"}),((R=O==null?void 0:O.plan)==null?void 0:R.task_id)&&s.jsxs(q,{color:"blue",children:["ID: ",O.plan.task_id]})]}),className:ce.taskPlanCard,size:"small",children:[s.jsx(G,{size:"small",dataSource:K,locale:{emptyText:"暂无步骤"},renderItem:(D,ee)=>{var F,ae;return s.jsxs(G.Item,{children:[s.jsx(G.Item.Meta,{avatar:Vs(D)?s.jsx(Za,{}):s.jsx(yn,{style:{color:"#52c41a"}}),title:`步骤 ${ee+1}: ${D.title||D.detail||D.id}`,description:D.detail||((ae=(F=D.metadata)==null?void 0:F.source)==null?void 0:ae.action)||"—"}),Vs(D)&&s.jsx(q,{children:"提示"})]})}}),s.jsxs("div",{className:ce.planActions,children:[s.jsx(Z,{type:"primary",onClick:A,size:"small",children:"执行此计划"}),s.jsx(un,{type:"secondary",className:ce.planHint,children:"任务将创建到“任务中心”，执行结果可在右上角入口查看。"})]})]})};return s.jsxs("div",{className:ce.chatPage,children:[s.jsx("div",{className:ce.sidebar,children:s.jsx(Bc,{onSelect:B})}),s.jsxs("div",{className:ce.chatContainer,children:[s.jsxs("div",{className:ce.messages,children:[v.length===0&&s.jsxs("div",{className:ce.welcome,children:[s.jsx(is,{style:{fontSize:48,color:"#1890ff"}}),s.jsx("h2",{children:"你好！我可以帮你完成网页自动化任务"}),s.jsx("p",{children:"请描述你想要做什么，或者选择一个任务模板"})]}),v.map(O=>s.jsxs("div",{className:`${ce.message} ${O.role==="user"?ce.userMessage:ce.assistantMessage}`,children:[s.jsx("div",{className:ce.messageAvatar,children:O.role==="user"?s.jsx(Xa,{}):s.jsx(is,{})}),s.jsxs("div",{className:ce.messageContent,children:[s.jsx("div",{className:ce.messageText,children:O.content}),O.taskPlan&&re(O.taskPlan),O.suggestions&&O.suggestions.length>0&&s.jsx(L,{wrap:!0,className:ce.suggestions,children:O.suggestions.map((K,X)=>s.jsx(q,{onClick:()=>t(K),style:{cursor:"pointer"},children:K},X))})]})]},O.id)),g&&s.jsxs("div",{className:`${ce.message} ${ce.assistantMessage}`,children:[s.jsx("div",{className:ce.messageAvatar,children:s.jsx(is,{})}),s.jsxs("div",{className:ce.messageContent,children:[s.jsx(Pe,{size:"small"})," ",s.jsx("span",{className:ce.typingText,children:"正在思考..."})]})]}),s.jsx("div",{ref:u})]}),s.jsx("div",{className:ce.inputArea,children:s.jsxs(he,{bordered:!1,className:ce.inputCard,children:[s.jsx("div",{className:ce.plannerControls,children:s.jsxs(L,{wrap:!0,children:[s.jsx(Re,{value:r,options:ud,onChange:O=>n(O),size:"small",style:{width:140}}),r==="llm"&&s.jsxs(s.Fragment,{children:[s.jsx(Re,{value:a,options:pd,onChange:O=>o(O),size:"small",style:{width:140}}),s.jsx(xe,{value:l,onChange:O=>c(O.target.value),size:"small",placeholder:"模型名称，例如 gpt-4o-mini",style:{width:220}})]})]})}),s.jsx(un,{type:"secondary",className:ce.helperText,children:"建议描述具体页面和操作；LLM 模式依赖后端环境变量中的 API Key。"}),s.jsx(dd,{value:e,onChange:O=>t(O.target.value),onKeyPress:N,placeholder:"请输入任务描述... (Shift+Enter 换行)",autoSize:{minRows:3,maxRows:8},className:ce.textarea}),s.jsx("div",{className:ce.inputActions,children:s.jsx(Z,{type:"primary",icon:s.jsx(Qa,{}),onClick:E,disabled:!e.trim()||g,size:"large",children:"发送"})})]})})]})]})}const hd="_perceivePage_1aznc_1",md="_card_1aznc_6",xd="_results_1aznc_11",yd="_resultCard_1aznc_15",_d="_jsonOutput_1aznc_20",gd="_logOutput_1aznc_21",Ue={perceivePage:hd,card:md,results:xd,resultCard:yd,jsonOutput:_d,logOutput:gd},{Panel:Ws}=gn;function jd(){const[e]=z.useForm(),[t,r]=y.useState(!1),[n,a]=y.useState(null),[o,l]=y.useState(null),c=async g=>{r(!0),l(null),a(null);try{const w={url:g.url,mode:g.mode,screenshot:g.screenshot,insights:g.insights};g.mode==="custom"&&(w.structural=g.structural,w.visual=g.visual,w.semantic=g.semantic);const f=await Q.perceive(w);a(f),f.success||l("Perception failed. Check stderr output below.")}catch(w){l(w instanceof Error?w.message:"Failed to execute perception")}finally{r(!1)}},p=()=>{var w;if(!((w=n==null?void 0:n.perception)!=null&&w.structural))return null;const g=n.perception.structural;return s.jsx(he,{title:"🏗️ Structural Perception",size:"small",className:Ue.resultCard,children:s.jsxs(U,{column:2,size:"small",children:[s.jsx(U.Item,{label:"DOM Nodes",children:g.dom_node_count}),s.jsx(U.Item,{label:"Forms",children:g.form_count}),s.jsx(U.Item,{label:"Interactive Elements",children:g.interactive_count}),s.jsx(U.Item,{label:"Text Nodes",children:g.text_node_count})]})})},i=()=>{var w,f;if(!((w=n==null?void 0:n.perception)!=null&&w.visual))return null;const g=n.perception.visual;return s.jsx(he,{title:"🎨 Visual Perception",size:"small",className:Ue.resultCard,children:s.jsxs(U,{column:2,size:"small",children:[s.jsxs(U.Item,{label:"Viewport",children:[g.viewport_width," × ",g.viewport_height]}),s.jsx(U.Item,{label:"Dominant Colors",children:s.jsx(L,{children:(f=g.dominant_colors)==null?void 0:f.map((b,_)=>s.jsx(q,{color:b,children:b},_))})})]})})},u=()=>{var w;if(!((w=n==null?void 0:n.perception)!=null&&w.semantic))return null;const g=n.perception.semantic;return s.jsx(he,{title:"🧠 Semantic Perception",size:"small",className:Ue.resultCard,children:s.jsxs(U,{column:1,size:"small",children:[s.jsx(U.Item,{label:"Content Type",children:g.content_type}),s.jsx(U.Item,{label:"Main Heading",children:g.main_heading}),s.jsx(U.Item,{label:"Language",children:g.language})]})})},v=()=>{var g;return!((g=n==null?void 0:n.perception)!=null&&g.insights)||n.perception.insights.length===0?null:s.jsx(he,{title:"💡 Insights",size:"small",className:Ue.resultCard,children:s.jsx(L,{direction:"vertical",style:{width:"100%"},children:n.perception.insights.map((w,f)=>s.jsx(Le,{message:w.type,description:w.message,type:w.severity==="warning"?"warning":"info",showIcon:!0},f))})})};return s.jsx("div",{className:Ue.perceivePage,children:s.jsxs(he,{title:"🔍 Multi-Modal Page Perception",className:Ue.card,children:[s.jsxs(z,{form:e,layout:"vertical",initialValues:{url:"https://example.com",mode:"all",screenshot:!0,insights:!0},onFinish:c,children:[s.jsx(z.Item,{label:"Target URL",name:"url",rules:[{required:!0,message:"Please enter a URL"}],children:s.jsx(xe,{placeholder:"https://example.com",size:"large"})}),s.jsx(z.Item,{label:"Perception Mode",name:"mode",children:s.jsxs(Re,{size:"large",children:[s.jsx(Re.Option,{value:"all",children:"All (Structural + Visual + Semantic)"}),s.jsx(Re.Option,{value:"structural",children:"Structural Only"}),s.jsx(Re.Option,{value:"visual",children:"Visual Only"}),s.jsx(Re.Option,{value:"semantic",children:"Semantic Only"}),s.jsx(Re.Option,{value:"custom",children:"Custom Selection"})]})}),s.jsx(z.Item,{noStyle:!0,shouldUpdate:(g,w)=>g.mode!==w.mode,children:({getFieldValue:g})=>g("mode")==="custom"?s.jsxs(L,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[s.jsx(z.Item,{name:"structural",valuePropName:"checked",noStyle:!0,children:s.jsx($t,{children:"Structural Perception"})}),s.jsx(z.Item,{name:"visual",valuePropName:"checked",noStyle:!0,children:s.jsx($t,{children:"Visual Perception"})}),s.jsx(z.Item,{name:"semantic",valuePropName:"checked",noStyle:!0,children:s.jsx($t,{children:"Semantic Perception"})})]}):null}),s.jsxs(L,{children:[s.jsx(z.Item,{name:"screenshot",valuePropName:"checked",noStyle:!0,children:s.jsx($t,{children:"Capture Screenshot"})}),s.jsx(z.Item,{name:"insights",valuePropName:"checked",noStyle:!0,children:s.jsx($t,{children:"Generate Insights"})})]}),s.jsx(z.Item,{style:{marginTop:24},children:s.jsx(Z,{type:"primary",htmlType:"submit",icon:s.jsx(xr,{}),loading:t,size:"large",block:!0,children:"Run Perception"})})]}),o&&s.jsx(Le,{message:"Error",description:o,type:"error",showIcon:!0,closable:!0,style:{marginTop:16}}),t&&s.jsx("div",{style:{textAlign:"center",padding:40},children:s.jsx(Pe,{size:"large",tip:"Running perception..."})}),n&&s.jsxs("div",{className:Ue.results,children:[s.jsx(Le,{message:n.success?"Success":"Failed",type:n.success?"success":"error",showIcon:!0,style:{marginBottom:16}}),s.jsxs(L,{direction:"vertical",style:{width:"100%"},size:"large",children:[p(),i(),u(),v(),n.screenshot_base64&&s.jsx(he,{title:s.jsxs(s.Fragment,{children:[s.jsx(to,{})," Screenshot"]}),size:"small",className:Ue.resultCard,children:s.jsx(eo,{src:`data:image/png;base64,${n.screenshot_base64}`,alt:"Page Screenshot",style:{maxWidth:"100%"}})}),s.jsxs(gn,{children:[s.jsx(Ws,{header:s.jsxs(s.Fragment,{children:[s.jsx(so,{})," Raw JSON Payload"]}),children:s.jsx("pre",{className:Ue.jsonOutput,children:JSON.stringify(n.perception,null,2)})},"json"),n.stdout&&s.jsx(Ws,{header:"📝 STDOUT",children:s.jsx("pre",{className:Ue.logOutput,children:n.stdout})},"stdout"),n.stderr&&s.jsx(Ws,{header:"⚠️ STDERR",children:s.jsx("pre",{className:Ue.logOutput,children:n.stderr})},"stderr")]})]})]})]})})}const bd="_wrapper_1uhud_1",vd="_sectionCard_1uhud_7",wd="_cardTitle_1uhud_11",Sd="_cardTitleIcon_1uhud_17",Td="_inlineForm_1uhud_21",Cd="_resultBlock_1uhud_31",kd="_hintText_1uhud_44",Id="_strategyRow_1uhud_61",Nd="_strategyHeader_1uhud_66",Rd="_strategyTags_1uhud_74",Pd="_strategyDescription_1uhud_80",Ed="_strategyMeta_1uhud_85",Od="_memoryStatsGrid_1uhud_95",H={wrapper:bd,sectionCard:vd,cardTitle:wd,cardTitleIcon:Sd,inlineForm:Td,resultBlock:Cd,hintText:kd,strategyRow:Id,strategyHeader:Nd,strategyTags:Rd,strategyDescription:Pd,strategyMeta:Ed,memoryStatsGrid:Od},{TextArea:Ad}=xe,{Paragraph:et}=I,$d="Navigate to https://example.com and tell me what you see";function Ld(){var rs;const{baseUrl:e,setBaseUrl:t}=la(),[r,n]=y.useState(e),[a,o]=y.useState("idle"),[l,c]=y.useState(""),[p,i]=y.useState($d),[u,v]=y.useState(!1),[g,w]=y.useState(null),[f,b]=y.useState(null),[_,E]=y.useState("https://example.com"),[N,B]=y.useState("structural"),[A,re]=y.useState(90),[O,K]=y.useState(!1),[X,R]=y.useState(null),[D,ee]=y.useState(null),[F,ae]=y.useState(null),[de,_e]=y.useState(!1),[S,te]=y.useState([]),[ie,ye]=y.useState(!1),[ge,je]=y.useState(10),[Ce,Me]=y.useState(),[ue,Ge]=y.useState(null),[Yt,ht]=y.useState(!1),[mt,xt]=y.useState([]),[Ke,yt]=y.useState(!1),[pe,_t]=y.useState(null),[gt,jt]=y.useState(!1),tt=()=>{t(r),P.success("后端地址已更新")},Ye=async()=>{o("loading"),c("");try{const j=await Q.health();o("success"),c(JSON.stringify(j,null,2))}catch(j){o("error"),c(j instanceof Error?j.message:"Health check failed")}},Xt=async()=>{if(!p.trim()){P.warning("请输入测试提示词");return}v(!0),w(null),b(null);try{const j=await Q.chat({prompt:p,execute:!1});b(j)}catch(j){w(j instanceof Error?j.message:"Chat API 调用失败")}finally{v(!1)}},Qt=async()=>{if(!_.trim()){P.warning("请输入要感知的 URL");return}K(!0),R(null),ee(null);try{const j=await Q.perceive({url:_,mode:N,screenshot:!1,insights:N==="all",timeout:A});ee(j),j.success||R(j.error||"Perceive API 返回失败")}catch(j){R(j instanceof Error?j.message:"Perceive API 调用失败")}finally{K(!1)}},st=j=>s.jsx("pre",{className:H.resultBlock,children:JSON.stringify(j,null,2)}),Je=async()=>{_e(!0);try{const j=await Q.getPerceptionMetrics();ae(j)}catch{P.error("无法获取感知指标")}finally{_e(!1)}};y.useEffect(()=>{Je()},[]),y.useEffect(()=>{Qe()},[]),y.useEffect(()=>{Pt()},[]),y.useEffect(()=>{Xe()},[ge,Ce]);const Xe=async()=>{ye(!0);try{const j=await Q.listRecordings(ge,Ce);te(j.recordings||[])}catch(j){console.error(j),P.error("无法获取录制会话")}finally{ye(!1)}},Zt=async j=>{ht(!0),Ge(null);try{const we=await Q.getRecording(j);we.success?Ge(we.recording):P.warning("录制会话未找到")}catch(we){console.error(we),P.error("获取录制详情失败")}finally{ht(!1)}},Qe=async()=>{yt(!0);try{const j=await Q.listSelfHealStrategies();xt(j)}catch(j){console.error(j),P.error("无法获取自愈策略")}finally{yt(!1)}},Pt=async()=>{jt(!0);try{const j=await Q.getMemoryStats();_t(j)}catch(j){console.error(j),P.error("无法获取 Memory 统计")}finally{jt(!1)}},es=async(j,we)=>{xt(ke=>ke.map(Ne=>Ne.id===j.id?{...Ne,enabled:we}:Ne));try{await Q.setSelfHealStrategyEnabled(j.id,we),P.success(`${j.id} ${we?"已启用":"已关闭"}`)}catch(ke){xt(Ne=>Ne.map(Ie=>Ie.id===j.id?{...Ie,enabled:j.enabled}:Ie)),P.error(ke instanceof Error?ke.message:"更新策略失败")}},ts=j=>{switch(j){case"auto_retry":return"green";case"human_approval":return"magenta";default:return"blue"}},ze=j=>{switch(j.action.kind){case"auto_retry":return`额外重试 ${j.action.extra_attempts} 次`;case"annotate":return`标注 ${j.action.severity??"info"}${j.action.note?` · ${j.action.note}`:""}`;case"human_approval":return`人工确认 (${j.action.severity??"warn"})`;default:return""}},He=j=>typeof j=="number"?`${(j*100).toFixed(1)}%`:"—",ss=[];pe&&(pe.hit_rate<.5&&ss.push({type:"warning",message:"Memory 命中率偏低",description:`当前命中率 ${He(pe.hit_rate)}，请检查 namespace/tag 配置。`}),pe.template_success_rate<.5&&pe.template_uses>10&&ss.push({type:"warning",message:"模板成功率偏低",description:`模板成功率 ${He(pe.template_success_rate)}，请复核模板内容。`}));const rt=j=>{var ke;const we=(ke=j.metadata)==null?void 0:ke.agent_plan;if(!we){P.info("该录制会话没有计划快照");return}try{const Ne=new Blob([JSON.stringify(we,null,2)],{type:"application/json"}),Ie=URL.createObjectURL(Ne),bt=document.createElement("a");bt.href=Ie,bt.download=`${j.id}-plan.json`,bt.click(),URL.revokeObjectURL(Ie)}catch(Ne){console.error(Ne),P.error("导出计划失败")}};return s.jsxs("div",{className:H.wrapper,children:[s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(ro,{className:H.cardTitleIcon}),"连接设置"]}),children:s.jsxs(L,{direction:"vertical",style:{width:"100%"},size:"large",children:[s.jsxs("div",{className:H.inlineForm,children:[s.jsx(xe,{placeholder:"http://127.0.0.1:8791",value:r,onChange:j=>n(j.target.value),allowClear:!0}),s.jsx(Z,{type:"primary",icon:s.jsx(mr,{}),onClick:tt,children:"保存并应用"})]}),s.jsx(et,{className:H.hintText,children:"不填表示使用当前域名。若通过 Vite DevServer 调试，可填写实际后端地址 (示例: http://127.0.0.1:8791)。"})]})}),s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(Ar,{className:H.cardTitleIcon}),"Memory 统计"]}),extra:s.jsx(Z,{type:"link",onClick:()=>Pt(),loading:gt,children:"刷新"}),children:gt?s.jsx(Pe,{}):pe?s.jsxs(L,{direction:"vertical",style:{width:"100%"},size:"middle",children:[ss.map((j,we)=>s.jsx(Le,{type:j.type,showIcon:!0,message:j.message,description:j.description},`memory-alert-${we}`)),s.jsxs("div",{className:H.memoryStatsGrid,children:[s.jsx(me,{title:"总查询",value:pe.total_queries}),s.jsx(me,{title:"命中",value:pe.hit_queries}),s.jsx(me,{title:"未命中",value:pe.miss_queries}),s.jsx(me,{title:"命中率",value:He(pe.hit_rate),valueStyle:{color:pe.hit_rate>=.7?"#3f8600":"#faad14"}}),s.jsx(me,{title:"当前记录",value:pe.current_records}),s.jsx(me,{title:"累计写入",value:pe.stored_records}),s.jsx(me,{title:"删除",value:pe.deleted_records}),s.jsx(me,{title:"模板使用",value:pe.template_uses}),s.jsx(me,{title:"模板成功",value:pe.template_successes}),s.jsx(me,{title:"模板成功率",value:He(pe.template_success_rate),valueStyle:{color:pe.template_success_rate>=.7?"#3f8600":"#faad14"}})]})]}):s.jsx(et,{className:H.hintText,children:"暂无统计信息。执行一次 Memory 查询后刷新以查看最新数据。"})}),s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(Ft,{className:H.cardTitleIcon}),"自愈策略"]}),extra:s.jsx(Z,{type:"link",onClick:()=>Qe(),loading:Ke,children:"刷新"}),children:Ke?s.jsx(Pe,{}):mt.length?s.jsx(G,{itemLayout:"vertical",dataSource:mt,renderItem:j=>{var we;return s.jsx(G.Item,{className:H.strategyRow,actions:[s.jsx(cs,{checked:j.enabled,size:"small",onChange:ke=>es(j,ke)},"toggle")],children:s.jsx(G.Item.Meta,{title:s.jsxs("div",{className:H.strategyHeader,children:[s.jsx("span",{children:j.id}),s.jsx("div",{className:H.strategyTags,children:(we=j.tags)==null?void 0:we.map(ke=>s.jsx(q,{color:"default",children:ke},`${j.id}-${ke}`))})]}),description:s.jsxs("div",{children:[s.jsx("div",{className:H.strategyDescription,children:j.description}),s.jsxs("div",{className:H.strategyMeta,children:[s.jsx(q,{color:ts(j.action.kind),children:j.action.kind}),j.telemetry_label&&s.jsx(q,{color:"geekblue",children:j.telemetry_label}),s.jsx("span",{children:ze(j)})]})]})})},j.id)}}):s.jsx(et,{className:H.hintText,children:"暂无策略。确认后端已升级到 Stage-2 自愈配置。"})}),s.jsxs(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(Ar,{className:H.cardTitleIcon}),"录制会话"]}),extra:s.jsxs(L,{children:[s.jsx(Re,{allowClear:!0,placeholder:"状态",value:Ce,style:{width:160},onChange:j=>Me(j||void 0),options:[{label:"recording",value:"recording"},{label:"completed",value:"completed"}]}),s.jsx(Tt,{min:1,max:50,value:ge,onChange:j=>je(j??10)}),s.jsx(Z,{type:"link",onClick:()=>Xe(),loading:ie,children:"刷新"})]}),children:[ie?s.jsx(Pe,{}):S.length?s.jsx(G,{size:"small",dataSource:S,renderItem:j=>s.jsx(G.Item,{actions:[s.jsx(Z,{type:"link",onClick:()=>Zt(j.id),children:"查看详情"},"view")],children:s.jsx(G.Item.Meta,{title:`${j.id} (${j.state})`,description:`updated: ${j.updated_at} · plan: ${j.has_agent_plan?"YES":"—"}`})})}):s.jsx(et,{className:H.hintText,children:"暂无录制会话"}),Yt?s.jsx(Pe,{style:{marginTop:12}}):ue?s.jsxs(s.Fragment,{children:[s.jsx(L,{style:{marginTop:12,marginBottom:12},children:s.jsx(Z,{type:"primary",icon:s.jsx(zt,{}),disabled:!((rs=ue.metadata)!=null&&rs.agent_plan),onClick:()=>rt(ue),children:"下载计划 JSON"})}),s.jsx("pre",{className:H.resultBlock,children:JSON.stringify(ue,null,2)})]}):null]}),s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(hs,{className:H.cardTitleIcon}),"感知服务指标"]}),extra:s.jsx(Z,{type:"link",onClick:()=>Je(),loading:de,children:"刷新"}),children:F?s.jsxs(U,{column:2,bordered:!0,size:"small",children:[s.jsx(U.Item,{label:"总调用次数",children:F.total_runs}),s.jsx(U.Item,{label:"平均时长 (ms)",children:F.avg_duration_ms.toFixed(2)}),s.jsx(U.Item,{label:"共享命中",children:F.shared_hits}),s.jsx(U.Item,{label:"共享未命中",children:F.shared_misses}),s.jsx(U.Item,{label:"共享失败",children:F.shared_failures}),s.jsx(U.Item,{label:"临时会话",children:F.ephemeral_runs}),s.jsx(U.Item,{label:"失败次数",children:F.failed_runs})]}):s.jsx(et,{className:H.hintText,children:"暂无指标数据。执行一次感知请求或点击刷新按钮以查看最新统计。"})}),s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(no,{className:H.cardTitleIcon}),"健康检查 /health"]}),extra:s.jsx(Z,{type:"primary",loading:a==="loading",onClick:Ye,children:"立即检测"}),children:a!=="idle"?s.jsx(Le,{type:a==="success"?"success":"error",message:a==="success"?"后端在线":"无法连接后端",description:l,showIcon:!0}):s.jsx(et,{className:H.hintText,children:"点击“立即检测”确认后端是否可达。"})}),s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(is,{className:H.cardTitleIcon}),"Chat API 快速测试"]}),extra:s.jsx(Z,{type:"primary",loading:u,onClick:Xt,children:"发送测试请求"}),children:s.jsxs(L,{direction:"vertical",style:{width:"100%"},children:[s.jsx(Ad,{rows:3,value:p,onChange:j=>i(j.target.value),placeholder:"Describe the goal..."}),g&&s.jsx(Le,{type:"error",message:g,showIcon:!0}),f&&st(f),!f&&!g&&s.jsx(et,{className:H.hintText,children:"将调用 POST /api/chat，并展示原始 JSON 响应。"})]})}),s.jsx(he,{className:H.sectionCard,title:s.jsxs("div",{className:H.cardTitle,children:[s.jsx(hs,{className:H.cardTitleIcon}),"Perceive API 快速测试"]}),extra:s.jsx(Z,{type:"primary",loading:O,onClick:Qt,children:"执行感知"}),children:s.jsxs(L,{direction:"vertical",style:{width:"100%"},size:"middle",children:[s.jsx(xe,{value:_,onChange:j=>E(j.target.value),placeholder:"https://example.com",addonBefore:"URL"}),s.jsxs(L,{className:H.inlineForm,children:[s.jsx(Re,{value:N,onChange:j=>B(j),options:[{label:"Structural",value:"structural"},{label:"Visual",value:"visual"},{label:"Semantic",value:"semantic"},{label:"All",value:"all"}]}),s.jsx(Tt,{min:30,max:240,value:A,onChange:j=>re(typeof j=="number"?j:60),addonAfter:"s",placeholder:"超时时间"})]}),X&&s.jsx(Le,{type:"error",message:X,showIcon:!0}),D&&st(D),!D&&!X&&s.jsx(et,{className:H.hintText,children:"感知请求可能需要 1-2 分钟。执行结果会包含 stdout/stderr，便于排查。"})]})})]})}const Fd="_page_5c5uf_1",zd="_header_5c5uf_8",Md="_tableWrapper_5c5uf_15",Ud="_jsonPanel_5c5uf_22",Dd="_loadingPanel_5c5uf_38",Bd="_detailTabs_5c5uf_46",Hd="_logsPanel_5c5uf_50",qd="_logItem_5c5uf_59",Jd="_actionBar_5c5uf_63",Vd="_artifactSection_5c5uf_69",Wd="_artifactSummary_5c5uf_79",Gd="_artifactTable_5c5uf_84",Kd="_previewBlock_5c5uf_92",Yd="_visualPanel_5c5uf_103",Xd="_conversationBoard_5c5uf_109",Qd="_boardColumn_5c5uf_115",Zd="_overlayPreviewGrid_5c5uf_126",eu="_overlayPreviewCard_5c5uf_132",tu="_overlayThumbnail_5c5uf_148",su="_previewableImage_5c5uf_149",ru="_locatorText_5c5uf_164",nu="_evidenceGrid_5c5uf_170",au="_evidenceCard_5c5uf_176",ou="_overlayWrapper_5c5uf_192",lu="_overlayBox_5c5uf_197",iu="_liveCompanion_5c5uf_202",cu="_companionHeader_5c5uf_208",du="_liveBody_5c5uf_216",uu="_liveViewport_5c5uf_222",pu="_liveOverlayStage_5c5uf_233",fu="_liveScreenshot_5c5uf_238",hu="_liveOverlayBox_5c5uf_246",mu="_liveViewportFallback_5c5uf_257",xu="_liveSidebar_5c5uf_265",yu="_liveListItem_5c5uf_276",_u="_liveFrameList_5c5uf_280",gu="_overlayLabel_5c5uf_285",ju="_timelineItem_5c5uf_297",bu="_templateAlert_5c5uf_302",vu="_templatesSection_5c5uf_306",wu="_templateFilterForm_5c5uf_316",Su="_templatesContent_5c5uf_322",Tu="_templateListWrapper_5c5uf_328",Cu="_templateCard_5c5uf_333",ku="_templateCardBody_5c5uf_341",Iu="_templateTags_5c5uf_346",Nu="_templateMetadata_5c5uf_352",Ru="_templateActions_5c5uf_363",Pu="_templateCreateCard_5c5uf_368",Eu="_templateEmptyState_5c5uf_378",Ou="_evidenceLabel_5c5uf_389",Au="_clickable_5c5uf_393",$u="_contextPanel_5c5uf_397",Lu="_annotationPanel_5c5uf_403",Fu="_annotationList_5c5uf_409",zu="_annotationForm_5c5uf_418",Mu="_contextMedia_5c5uf_425",Uu="_contextStdout_5c5uf_440",Du="_contextInfo_5c5uf_446",Bu="_contextJson_5c5uf_454",T={page:Fd,header:zd,tableWrapper:Md,jsonPanel:Ud,loadingPanel:Dd,detailTabs:Bd,logsPanel:Hd,logItem:qd,actionBar:Jd,artifactSection:Vd,artifactSummary:Wd,artifactTable:Gd,previewBlock:Kd,visualPanel:Yd,conversationBoard:Xd,boardColumn:Qd,overlayPreviewGrid:Zd,overlayPreviewCard:eu,overlayThumbnail:tu,previewableImage:su,locatorText:ru,evidenceGrid:nu,evidenceCard:au,overlayWrapper:ou,overlayBox:lu,liveCompanion:iu,companionHeader:cu,liveBody:du,liveViewport:uu,liveOverlayStage:pu,liveScreenshot:fu,liveOverlayBox:hu,liveViewportFallback:mu,liveSidebar:xu,liveListItem:yu,liveFrameList:_u,overlayLabel:gu,timelineItem:ju,templateAlert:bu,templatesSection:vu,templateFilterForm:wu,templatesContent:Su,templateListWrapper:Tu,templateCard:Cu,templateCardBody:ku,templateTags:Iu,templateMetadata:Nu,templateActions:Ru,templateCreateCard:Pu,templateEmptyState:Eu,evidenceLabel:Ou,clickable:Au,contextPanel:$u,annotationPanel:Lu,annotationList:Fu,annotationForm:zu,contextMedia:Mu,contextStdout:Uu,contextInfo:Du,contextJson:Bu},Gs=e=>e&&We(e).isValid()?We(e).format("HH:mm:ss"):"—",Ks=(e,t)=>e!=null&&e.title?e.title:e!=null&&e.dispatch_label?e.dispatch_label:e!=null&&e.step_id?`Step ${e.step_id}`:t;function Hu({planOverlays:e,executionOverlays:t,logs:r,recentEvidence:n,onPreviewEvidence:a,onPreviewOverlay:o}){const l=r.slice(-5).reverse(),c=t.slice(-5).reverse(),p=n.slice(-5).reverse();return s.jsxs("div",{className:T.conversationBoard,children:[s.jsxs("div",{className:T.boardColumn,children:[s.jsx(I.Title,{level:5,children:"计划锚点"}),e!=null&&e.length?s.jsx(G,{size:"small",dataSource:e,renderItem:(i,u)=>s.jsx(G.Item,{children:s.jsxs(L,{direction:"vertical",size:2,children:[s.jsxs(L,{size:"small",children:[s.jsx(q,{color:"processing",children:(i==null?void 0:i.step_id)??`step-${u+1}`}),s.jsx(I.Text,{children:Ks(i,"步骤")})]}),s.jsx(I.Text,{type:"secondary",className:T.locatorText,children:Gs(i==null?void 0:i.recorded_at)}),(i==null?void 0:i.locator)&&s.jsx(I.Text,{type:"secondary",className:T.locatorText,children:JSON.stringify(i.locator)})]})},(i==null?void 0:i.step_id)??u)}):s.jsx(oe,{description:"暂无锚点"})]}),s.jsxs("div",{className:T.boardColumn,children:[s.jsx(I.Title,{level:5,children:"实时覆盖"}),c.length?s.jsx(G,{size:"small",dataSource:c,renderItem:(i,u)=>{var v,g,w,f,b,_,E;return s.jsx(G.Item,{children:s.jsxs(L,{direction:"vertical",size:2,children:[s.jsxs(L,{size:"small",children:[s.jsx(q,{color:i.source==="execution"?"volcano":"geekblue",children:i.source==="execution"?"执行":"计划"}),s.jsxs(I.Text,{children:[Ks(i.data,"overlay")," ·",((v=i.data)==null?void 0:v.step_id)||"step"]})]}),s.jsx(I.Text,{type:"secondary",className:T.locatorText,children:Gs(i.recorded_at)}),((g=i.data)==null?void 0:g.bbox)!==void 0&&s.jsxs(I.Text,{type:"secondary",className:T.locatorText,children:["bbox: ",JSON.stringify(i.data.bbox)]}),(w=i.data)!=null&&w.data_base64||(f=i.data)!=null&&f.screenshot_path?s.jsx("img",{className:T.overlayThumbnail,src:(b=i.data)!=null&&b.data_base64?`data:${((_=i.data)==null?void 0:_.content_type)??"image/png"};base64,${i.data.data_base64}`:(E=i.data)==null?void 0:E.screenshot_path,alt:Ks(i.data,"overlay"),onClick:()=>o==null?void 0:o(i)}):null]})},`${i.task_id}-${u}`)}}):s.jsx(oe,{description:"暂无实时覆盖"}),s.jsx(I.Title,{level:5,style:{marginTop:24},children:"最新截图"}),p.length?s.jsx("div",{className:T.overlayPreviewGrid,children:p.map((i,u)=>s.jsxs("div",{className:T.overlayPreviewCard,children:[s.jsx(I.Text,{className:T.evidenceLabel,children:(i==null?void 0:i.label)||(i==null?void 0:i.dispatch_label)||"截图"}),((i==null?void 0:i.observation_type)||(i==null?void 0:i.content_type))&&s.jsx(q,{color:"blue",style:{marginBottom:4},children:(i==null?void 0:i.observation_type)||(i==null?void 0:i.content_type)}),s.jsx(I.Text,{type:"secondary",className:T.locatorText,children:Gs(i==null?void 0:i.recorded_at)}),i.data_base64||i.screenshot_path?s.jsx("img",{src:i.data_base64?`data:${i.content_type};base64,${i.data_base64}`:i.screenshot_path,alt:(i==null?void 0:i.label)||`capture-${u}`,className:T.previewableImage,onClick:()=>a==null?void 0:a(i)}):s.jsx(I.Text,{type:"secondary",children:"暂无内嵌图像"})]},`${(i==null?void 0:i.step_id)??"shot"}-${u}`))}):s.jsx(oe,{description:"暂无截图"})]}),s.jsxs("div",{className:T.boardColumn,children:[s.jsx(I.Title,{level:5,children:"最新日志"}),l.length?s.jsx(G,{size:"small",dataSource:l,renderItem:(i,u)=>s.jsx(G.Item,{children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsxs(I.Text,{type:"secondary",children:[i.timestamp," · ",i.level.toUpperCase()]}),s.jsx(I.Text,{children:i.message})]})},`${i.timestamp}-${u}`)}):s.jsx(oe,{description:"暂无日志"})]})]})}const os=e=>e&&We(e).isValid()?We(e).format("HH:mm:ss"):"—";function qu({taskId:e,status:t,latestFrame:r,frames:n,overlays:a,annotations:o,streamConnected:l,streamPaused:c,streamError:p,onTogglePause:i,onReconnect:u,onPreviewFrame:v,onPreviewOverlay:g,onRefreshSummary:w}){var X;const[f,b]=y.useState({width:0,height:0}),[_,E]=y.useState({width:0,height:0}),N=y.useRef(null),B=y.useMemo(()=>a.slice(-6).reverse(),[a]),A=y.useMemo(()=>o.slice(-6).reverse(),[o]),re=y.useMemo(()=>n.slice().reverse(),[n]),O=R=>{const D=R.currentTarget;b({width:D.naturalWidth,height:D.naturalHeight}),E({width:D.clientWidth,height:D.clientHeight}),N.current=D},K=R=>{if(!R||typeof R!="object"||_.width===0||_.height===0)return;const D=R,ee=Number(D.width??D.w??D[2]),F=Number(D.height??D.h??D[3]),ae=Number(D.x??D.left??D[0]),de=Number(D.y??D.top??D[1]);if(!Number.isFinite(ee)||!Number.isFinite(F)||!Number.isFinite(ae)||!Number.isFinite(de))return;const _e=ee>0&&ee<=1&&F>0&&F<=1&&ae>=0&&ae<=1&&de>=0&&de<=1,S=_e?_.width:f.width>0?_.width/f.width:1,te=_e?_.height:f.height>0?_.height/f.height:1,ie=_e?ae*_.width:ae*S,ye=_e?de*_.height:de*te,ge=_e?ee*_.width:ee*S,je=_e?F*_.height:F*te;return{left:ie,top:ye,width:Math.max(ge,2),height:Math.max(je,2)}};return s.jsxs("div",{className:T.liveCompanion,children:[s.jsxs("div",{className:T.companionHeader,children:[s.jsxs(L,{size:"middle",wrap:!0,children:[s.jsx(ao,{status:l?"processing":"default",text:l?"实时连接中":c?"已暂停":"未连接"}),s.jsx(q,{color:(t==null?void 0:t.status)==="success"?"green":(t==null?void 0:t.status)==="failed"?"red":"gold",children:((X=t==null?void 0:t.status)==null?void 0:X.toUpperCase())||"PENDING"}),(r==null?void 0:r.recordedAt)&&s.jsxs(I.Text,{type:"secondary",children:["最新截图：",os(r.recordedAt)]}),e&&s.jsx(I.Text,{type:"secondary",copyable:!0,children:e}),p&&s.jsx(xn,{title:p,children:s.jsx(q,{color:"red",children:p})})]}),s.jsxs(L,{children:[s.jsx(Z,{icon:c?s.jsx(xr,{}):s.jsx(oo,{}),onClick:i,children:c?"恢复实时":"暂停实时"}),s.jsx(Z,{icon:s.jsx(lo,{}),onClick:u,children:"手动重连"}),s.jsx(Z,{icon:s.jsx(yr,{}),onClick:w,children:"刷新快照"})]})]}),s.jsxs("div",{className:T.liveBody,children:[s.jsx("div",{className:T.liveViewport,children:r!=null&&r.src?s.jsxs("div",{className:T.liveOverlayStage,children:[s.jsx("img",{ref:N,src:r.src,alt:r.label||"live-frame",className:T.liveScreenshot,onLoad:O,onClick:()=>v==null?void 0:v(r.record)}),B.map((R,D)=>{var _e;const ee=K((_e=R.data)==null?void 0:_e.bbox);if(!ee)return null;const F=R.data,ae=(F==null?void 0:F.title)??(F==null?void 0:F.dispatch_label)??"overlay",de=typeof ae=="string"?ae:JSON.stringify(ae??"overlay");return s.jsx("div",{className:T.liveOverlayBox,style:ee,children:s.jsx("span",{children:de})},`${R.task_id}-${D}`)})]}):s.jsx("div",{className:T.liveViewportFallback,children:s.jsx(oe,{description:"暂无实时截图"})})}),s.jsxs("div",{className:T.liveSidebar,children:[s.jsx(he,{size:"small",title:"实时覆盖",children:B.length?s.jsx(G,{size:"small",dataSource:B,renderItem:(R,D)=>s.jsx(G.Item,{onClick:()=>g==null?void 0:g(R),className:T.liveListItem,children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsxs(L,{size:"small",children:[s.jsx(q,{color:R.source==="execution"?"orange":"blue",children:R.source}),s.jsx(I.Text,{children:(()=>{const ee=R.data,F=(ee==null?void 0:ee.title)??(ee==null?void 0:ee.dispatch_label)??"overlay";return typeof F=="string"?F:JSON.stringify(F??"overlay")})()})]}),s.jsx(I.Text,{type:"secondary",style:{fontSize:12},children:os(R.recorded_at)})]})},`${R.task_id}-${D}`)}):s.jsx(oe,{description:"暂无 Overlay",image:oe.PRESENTED_IMAGE_SIMPLE})}),s.jsx(he,{size:"small",title:"批注",children:A.length?s.jsx(G,{size:"small",dataSource:A,renderItem:R=>s.jsx(G.Item,{className:T.liveListItem,children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsxs(L,{size:"small",children:[R.severity&&s.jsx(q,{color:"magenta",children:R.severity}),s.jsx(I.Text,{children:R.note})]}),s.jsxs(I.Text,{type:"secondary",style:{fontSize:12},children:[R.author||"system"," · ",os(R.created_at)]})]})},R.id)}):s.jsx(oe,{description:"暂无批注",image:oe.PRESENTED_IMAGE_SIMPLE})}),s.jsx(he,{size:"small",title:"截图历史",children:re.length?s.jsx(G,{size:"small",className:T.liveFrameList,dataSource:re,renderItem:R=>s.jsx(G.Item,{className:T.liveListItem,onClick:()=>v==null?void 0:v(R.record),children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsx(I.Text,{children:R.label||"capture"}),s.jsx(I.Text,{type:"secondary",style:{fontSize:12},children:os(R.recordedAt)})]})},R.id)}):s.jsx(oe,{description:"暂无截图",image:oe.PRESENTED_IMAGE_SIMPLE})})]})]})]})}const Ys="templates";function Ju({onApplyTemplate:e,onTemplateDeleted:t,onTemplateUpdated:r}){const[n,a]=y.useState([]),[o,l]=y.useState(!1),[c,p]=y.useState(!1),[i,u]=y.useState(null),[v]=z.useForm(),[g]=z.useForm(),[w]=z.useForm(),[f,b]=y.useState(null),[_,E]=y.useState(!1),[N,B]=y.useState(!1),[A,re]=y.useState(null),[O,K]=y.useState(!1),X=y.useCallback(async S=>{var ie,ye;const te=S??v.getFieldsValue(!0);l(!0);try{const ge={namespace:((ie=te.namespace)==null?void 0:ie.trim())||void 0,tag:((ye=te.tag)==null?void 0:ye.trim())||void 0,limit:te.limit},je=await Q.listMemoryRecords(ge);a(je)}catch(ge){console.error(ge),P.error("无法加载模板列表")}finally{l(!1)}},[v]),R=y.useCallback(async()=>{K(!0);try{const S=await Q.getMemoryStats();re(S)}catch(S){console.error(S),P.warning("无法获取记忆统计")}finally{K(!1)}},[]);y.useEffect(()=>{v.setFieldsValue({namespace:Ys,limit:20}),g.setFieldsValue({namespace:Ys}),X({namespace:Ys,limit:20}),R()},[g,X,R,v]);const D=S=>{X(S)},ee=async S=>{var je,Ce,Me;const te=(je=S.namespace)==null?void 0:je.trim(),ie=(Ce=S.key)==null?void 0:Ce.trim();if(!te||!ie){P.warning("命名空间和 Key 必填");return}let ye;if(S.metadata&&S.metadata.trim().length>0)try{ye=JSON.parse(S.metadata)}catch(ue){console.error(ue),P.error("Metadata 必须是合法 JSON");return}const ge={namespace:te,key:ie,note:((Me=S.note)==null?void 0:Me.trim())||void 0,tags:S.tags?S.tags.split(",").map(ue=>ue.trim()).filter(ue=>ue.length>0):void 0,metadata:ye};p(!0);try{await Q.createMemoryRecord(ge),P.success("模板已保存"),g.resetFields(),g.setFieldsValue({namespace:te}),X(),R()}catch(ue){console.error(ue),P.error("保存模板失败")}finally{p(!1)}},F=S=>{e==null||e(S)},ae=y.useCallback(async S=>{u(S.id);try{await Q.deleteMemoryRecord(S.id),P.success("模板已删除"),a(te=>te.filter(ie=>ie.id!==S.id)),t==null||t(S),(f==null?void 0:f.id)===S.id&&(E(!1),b(null),w.resetFields())}catch(te){console.error(te),P.error("删除模板失败")}finally{u(null),X(),R()}},[w,f,X,R,t]),de=y.useCallback(S=>{b(S),w.setFieldsValue({tags:S.tags.join(","),note:S.note||"",metadata:S.metadata?JSON.stringify(S.metadata,null,2):""}),E(!0)},[w]),_e=y.useCallback(async()=>{if(f)try{const S=await w.validateFields(),te={};if(S.tags!==void 0){const ye=S.tags?S.tags.split(",").map(ge=>ge.trim()).filter(ge=>ge.length>0):[];te.tags=ye}if(S.note!==void 0){const ye=S.note.trim();te.note=ye.length?ye:null}if(S.metadata!==void 0&&(S.metadata.trim()?te.metadata=JSON.parse(S.metadata):te.metadata=null),!("tags"in te)&&!("note"in te)&&!("metadata"in te)){P.info("无更新内容");return}B(!0);const ie=await Q.updateMemoryRecord(f.id,te);a(ye=>ye.map(ge=>ge.id===ie.id?ie:ge)),r==null||r(ie),P.success("模板已更新"),E(!1),b(null),w.resetFields(),R()}catch(S){if(S!=null&&S.errorFields)return;if(S instanceof SyntaxError){P.error("Metadata 必须是合法 JSON");return}console.error(S),P.error("更新模板失败");return}finally{B(!1)}},[w,f,r]);return s.jsxs("div",{className:T.templatesSection,children:[s.jsxs("div",{children:[s.jsx(I.Title,{level:4,children:"记忆 / 模板"}),s.jsx(I.Text,{type:"secondary",children:"保存常用提示词和上下文，快速填充到任务创建表单"})]}),s.jsx("div",{style:{marginTop:12},children:s.jsx(Pe,{spinning:O,children:s.jsxs(U,{size:"small",bordered:!0,column:3,labelStyle:{fontWeight:500},children:[s.jsx(U.Item,{label:"查询次数",children:(A==null?void 0:A.total_queries)??0}),s.jsx(U.Item,{label:"命中次数",children:(A==null?void 0:A.hit_queries)??0}),s.jsx(U.Item,{label:"命中率",children:A?`${(A.hit_rate*100).toFixed(1)}%`:"0.0%"}),s.jsx(U.Item,{label:"存储次数",children:(A==null?void 0:A.stored_records)??0}),s.jsx(U.Item,{label:"删除次数",children:(A==null?void 0:A.deleted_records)??0}),s.jsx(U.Item,{label:"当前记录",children:(A==null?void 0:A.current_records)??0}),s.jsx(U.Item,{label:"模板使用",children:(A==null?void 0:A.template_uses)??0}),s.jsx(U.Item,{label:"模板成功",children:(A==null?void 0:A.template_successes)??0}),s.jsx(U.Item,{label:"模板成功率",children:A?`${(A.template_success_rate*100).toFixed(1)}%`:"0.0%"})]})})}),s.jsxs(z,{layout:"inline",form:v,className:T.templateFilterForm,onFinish:D,children:[s.jsx(z.Item,{label:"命名空间",name:"namespace",children:s.jsx(xe,{placeholder:"例如 templates",allowClear:!0})}),s.jsx(z.Item,{label:"标签",name:"tag",children:s.jsx(xe,{placeholder:"可选",allowClear:!0})}),s.jsx(z.Item,{label:"数量",name:"limit",children:s.jsx(Tt,{min:1,max:100,placeholder:"20"})}),s.jsx(z.Item,{children:s.jsxs(L,{children:[s.jsx(Z,{type:"primary",htmlType:"submit",children:"筛选"}),s.jsx(Z,{icon:s.jsx(yr,{}),onClick:()=>X(),children:"刷新"})]})})]}),s.jsxs("div",{className:T.templatesContent,children:[s.jsx("div",{className:T.templateListWrapper,children:n.length?s.jsx(G,{dataSource:n,loading:o,renderItem:S=>s.jsx(G.Item,{className:T.templateCard,children:s.jsxs(L,{direction:"vertical",size:6,className:T.templateCardBody,children:[s.jsxs(L,{size:8,wrap:!0,children:[s.jsx(I.Text,{strong:!0,children:S.key}),s.jsx(q,{color:"geekblue",children:S.namespace}),s.jsx(I.Text,{type:"secondary",children:new Date(S.created_at).toLocaleString()})]}),S.tags&&S.tags.length>0&&s.jsx("div",{className:T.templateTags,children:S.tags.map(te=>s.jsx(q,{children:te},`${S.id}-${te}`))}),S.note&&s.jsx(I.Text,{children:S.note}),S.metadata&&s.jsx("pre",{className:T.templateMetadata,children:JSON.stringify(S.metadata,null,2)}),s.jsxs(L,{size:8,wrap:!0,children:[s.jsxs(q,{color:"purple",children:["使用 ",S.use_count]}),s.jsxs(q,{color:"green",children:["成功 ",S.success_count]}),s.jsxs(I.Text,{type:"secondary",children:["最近使用：",S.last_used_at?We(S.last_used_at).format("YYYY-MM-DD HH:mm"):"未使用"]})]}),s.jsx("div",{className:T.templateActions,children:s.jsxs(L,{size:"small",children:[s.jsx(Z,{type:"primary",icon:s.jsx(xr,{}),onClick:()=>F(S),children:"填充任务"}),s.jsx(Z,{icon:s.jsx(io,{}),onClick:()=>de(S),children:"编辑"}),s.jsx(co,{title:"删除模板",description:"确认删除该模板？",okText:"删除",cancelText:"取消",onConfirm:()=>ae(S),children:s.jsx(Z,{icon:s.jsx(uo,{}),danger:!0,loading:i===S.id,children:"删除"})})]})})]})},S.id)}):s.jsx("div",{className:T.templateEmptyState,children:o?s.jsx(I.Text,{type:"secondary",children:"加载中…"}):s.jsx(oe,{description:"暂无模板"})})}),s.jsxs("div",{className:T.templateCreateCard,children:[s.jsx(I.Title,{level:5,children:"保存新模板"}),s.jsxs(z,{layout:"vertical",form:g,onFinish:ee,children:[s.jsx(z.Item,{label:"命名空间",name:"namespace",rules:[{required:!0,message:"请输入命名空间"}],children:s.jsx(xe,{placeholder:"例如 templates",allowClear:!0})}),s.jsx(z.Item,{label:"Key",name:"key",rules:[{required:!0,message:"请输入 Key"}],children:s.jsx(xe,{placeholder:"关键字",allowClear:!0})}),s.jsx(z.Item,{label:"标签",name:"tags",tooltip:"用逗号分隔",children:s.jsx(xe,{placeholder:"tag1,tag2",allowClear:!0})}),s.jsx(z.Item,{label:"备注",name:"note",children:s.jsx(xe.TextArea,{rows:2,placeholder:"说明或适用场景",allowClear:!0})}),s.jsx(z.Item,{label:"Metadata JSON",name:"metadata",children:s.jsx(xe.TextArea,{rows:4,placeholder:'{"prompt":"..."}',allowClear:!0})}),s.jsx(Z,{type:"primary",htmlType:"submit",icon:s.jsx(po,{}),loading:c,block:!0,children:"保存模板"})]})]})]}),s.jsx(ds,{title:f?`编辑模板：${f.key}`:"编辑模板",open:_,onCancel:()=>{E(!1),b(null),w.resetFields()},onOk:_e,confirmLoading:N,destroyOnClose:!0,children:s.jsxs(z,{layout:"vertical",form:w,children:[s.jsx(z.Item,{label:"标签",name:"tags",tooltip:"用逗号分隔",children:s.jsx(xe,{placeholder:"tag1,tag2",allowClear:!0})}),s.jsx(z.Item,{label:"备注",name:"note",children:s.jsx(xe.TextArea,{rows:3,placeholder:"说明或适用场景",allowClear:!0})}),s.jsx(z.Item,{label:"Metadata JSON",name:"metadata",children:s.jsx(xe.TextArea,{rows:4,placeholder:'{"prompt":"..."}',allowClear:!0})})]})})]})}const{TextArea:Xs}=xe,pn={pending:{color:"default",label:"待执行"},running:{color:"processing",label:"执行中"},success:{color:"success",label:"已完成"},failed:{color:"error",label:"失败"}},it=e=>e?We(e).format("YYYY-MM-DD HH:mm:ss"):"—",fn=e=>{const t=e?e.toLowerCase():"pending",r=pn[t]||pn.pending;return s.jsx(q,{color:r.color,children:r.label})},Qs=e=>{if(e==null)return"—";if(e<1024)return`${e} B`;const t=["KB","MB","GB"];let r=e/1024,n=0;for(;r>=1024&&n<t.length-1;)r/=1024,n+=1;return`${r.toFixed(1)} ${t[n]}`},Vu={info:"default",warn:"warning",error:"error"},Zs=50,Wu=e=>{if(e==null)return"—";if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}},Gu=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),St=e=>typeof e=="string"&&e.trim().length>0?e:void 0,er=e=>typeof e=="number"?e:void 0,tr=e=>typeof e=="boolean"?e:void 0,ot=e=>e&&We(e).isValid()?e:new Date().toISOString(),Ku=(e,t="overlay")=>e?typeof e.title=="string"&&e.title.trim()?e.title:typeof e.dispatch_label=="string"&&e.dispatch_label.trim()?e.dispatch_label:typeof e.step_id=="string"&&e.step_id.trim()?`Step ${e.step_id}`:t:t;function Yu(){const[e,t]=y.useState([]),[r,n]=y.useState(!1),[a,o]=y.useState(!1),[l,c]=y.useState(!1),[p,i]=y.useState(null),[u,v]=y.useState(null),[g,w]=y.useState(null),[f,b]=y.useState(null),[_,E]=y.useState([]),[N,B]=y.useState([]),[A,re]=y.useState(null),[O,K]=y.useState(!1),[X,R]=y.useState(!1),[D,ee]=y.useState(0),F=y.useRef(null),ae=y.useRef(null),[de,_e]=y.useState(!1),[S,te]=y.useState(!1),[ie,ye]=y.useState(!1),[ge,je]=y.useState(!1),[Ce,Me]=y.useState(!1),[ue,Ge]=y.useState(null),[Yt,ht]=y.useState(!1),[mt,xt]=y.useState({visible:!1}),[Ke,yt]=y.useState({visible:!1}),[pe,_t]=y.useState([]),[gt,jt]=y.useState([]),[tt,Ye]=y.useState([]),[Xt,Qt]=y.useState(!1),[st,Je]=y.useState([]),[Xe,Zt]=y.useState("all"),[Qe,Pt]=y.useState(""),[es,ts]=y.useState(!1),[ze]=z.useForm(),[He]=z.useForm(),rt=(z.useWatch("planner",ze)??"rule")==="llm",rs=z.useWatch("captureContext",ze)??!0,[j,we]=y.useState(null),ke=y.useCallback(d=>{try{const C=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),m=URL.createObjectURL(C),k=document.createElement("a");k.href=m;const $=`${d.task_id}-plan.json`;k.download=$,k.click(),URL.revokeObjectURL(m)}catch(C){console.error(C),P.error("导出计划失败")}},[]),Ne=y.useCallback(d=>{if(d.path){const C=d.path.split("/");return C[C.length-1]}return d.filename?d.filename:`${d.label||"artifact"}-${d.artifact_index+1}.json`},[]),Ie=y.useCallback((d,C="image/png")=>{if(!d)return null;const m=(d==null?void 0:d.content_type)||C;if(d.data_base64)return`data:${m};base64,${d.data_base64}`;if(d.screenshot_path)return d.screenshot_path;if(d!=null&&d.data_base64_inline)return`data:${m};base64,${d.data_base64_inline}`;if(d.data&&typeof d.data=="object"){const k=d.data;if(k.data_base64)return`data:${k.content_type||m};base64,${k.data_base64}`;if(k.screenshot_path)return k.screenshot_path}return null},[]),bt=y.useCallback(async d=>{if(!p){P.error("缺少任务 ID");return}try{const C=Ne(d),m=await Q.downloadTaskArtifact(p.task_id,C),k=URL.createObjectURL(m),$=document.createElement("a");$.href=k,$.download=C,$.click(),URL.revokeObjectURL(k)}catch(C){console.error(C),P.error("下载失败，请稍后重试")}},[Ne,p]),Et=y.useCallback(d=>{const C=Ie(d);if(!C){P.warning("该记录没有可预览的图像");return}yt({visible:!0,title:(d==null?void 0:d.label)||(d==null?void 0:d.dispatch_label)||"截图预览",src:C})},[Ie]),Ls=y.useCallback(d=>{const C=Ie(d.data);if(!C){P.warning("该覆盖没有可预览的图像");return}yt({visible:!0,title:Ku(d.data,"实时截图"),src:C})},[Ie]),ha=()=>{yt({visible:!1})},Ot=y.useMemo(()=>_.map((d,C)=>{const m=Ie(d);return m?{id:`${d.recorded_at||C}`,recordedAt:d.recorded_at,label:d.label||d.dispatch_label,src:m,record:d}:null}).filter(Boolean),[Ie,_]),Sr=Ot.length?Ot[Ot.length-1]:null,Tr=y.useCallback(d=>{if(!d.data_base64){P.warning("该 Artifact 未内嵌数据，请下载后查看");return}try{const C=Zu(d.data_base64),m=d.content_type.includes("json")?JSON.stringify(JSON.parse(C),null,2):C;xt({visible:!0,title:d.filename||d.label,content:m})}catch(C){console.error(C),P.error("无法解析该 Artifact 内容")}},[]),nt=y.useCallback(async()=>{n(!0);try{const d=await Q.listTasks();t(d)}catch(d){console.error(d),P.error("无法获取任务列表")}finally{n(!1)}},[]);y.useEffect(()=>{nt()},[nt]);const vt=y.useCallback(async d=>{var C,m,k;c(!0),re(null),ht(!0);try{const[$,V,le,M,Y,se]=await Promise.all([Q.getTask(d,100),Q.getTaskStatus(d).catch(()=>null),Q.getTaskLogs(d).catch(()=>[]),Q.getTaskArtifacts(d).catch(()=>null),Q.getTaskAnnotations(d).catch(()=>[]),Q.getTaskObservations(d,Zs).catch(()=>null)]);v($),w(V);const x=(V==null?void 0:V.context_snapshot)??((C=$.plan)==null?void 0:C.context_snapshot)??null;b(x??null);let W=!1;if(se!=null&&se.success){const ne=se.observations.map(be=>({...be,recorded_at:ot(be==null?void 0:be.recorded_at)}));Je(ne.slice(-Zs)),W=!0}else Je([]);if(V!=null&&V.recent_evidence){const ne=V.recent_evidence.map(be=>({...be,recorded_at:ot(be==null?void 0:be.recorded_at)}));E(ne.slice(-8)),W||Je(ne.slice(-Zs))}else E([]),W||Je([]);const fe=(V==null?void 0:V.plan_overlays)||(((k=(m=$.plan)==null?void 0:m.plan)==null?void 0:k.overlays)??[]);_t(Array.isArray(fe)?fe.map(ne=>({...ne,recorded_at:ot(ne==null?void 0:ne.recorded_at)})):[]),jt([]),B(le),Ge(M),Array.isArray(Y)&&Y.length?Ye(Y):$.annotations?Ye($.annotations):Ye([])}catch($){console.error($),P.error("无法加载任务详情")}finally{c(!1),ht(!1)}},[]),Cr=y.useCallback(()=>{p&&vt(p.task_id)},[vt,p]),ma=d=>{i(d),o(!0),c(!0),vt(d.task_id)},xa=()=>{o(!1),v(null),i(null),w(null),b(null),E([]),B([]),re(null),Ge(null),ht(!1),_t([]),jt([]),Ye([]),Je([]),He.resetFields()},kr=y.useCallback(()=>{R(d=>{const C=!d;return C||(re(null),ee(m=>m+1)),C})},[]),Ir=y.useCallback(()=>{if(F.current){try{F.current.close()}catch(d){console.warn("Failed to close socket before reconnect",d)}F.current=null}re(null),ee(d=>d+1)},[]);y.useEffect(()=>{if(!a||!p){K(!1);return}let d=!1;const C=()=>{ae.current&&(window.clearTimeout(ae.current),ae.current=null)},m=()=>{if(F.current){try{F.current.close()}catch(le){console.warn("Failed to close task stream socket",le)}F.current=null}},k=()=>{d||ae.current||X||(ae.current=window.setTimeout(()=>{ae.current=null,V()},3e3))},$=le=>{try{const M=JSON.parse(le.data);if(M.event==="status"){if(w(M.status),M.status.context_snapshot&&b(M.status.context_snapshot),M.status.recent_evidence){const Y=M.status.recent_evidence.map(se=>({...se,recorded_at:ot(se==null?void 0:se.recorded_at)}));E(Y.slice(-8))}if(M.status.plan_overlays){const Y=Array.isArray(M.status.plan_overlays)?M.status.plan_overlays.map(se=>({...se,recorded_at:ot(se==null?void 0:se.recorded_at)})):[];_t(Y)}v(Y=>Y&&{...Y,summary:{...Y.summary,last_status:M.status.status,last_recorded_at:M.status.last_updated_at}})}else if(M.event==="log")B(Y=>[...Y,M.log].slice(-200));else if(M.event==="context")b(M.context);else if(M.event==="observation"){const Y=M.artifact?{...M.artifact}:{},se={...Y,observation_type:M.observation_type,screenshot_path:M.screenshot_path,bbox:M.bbox,dispatch_label:M.dispatch_label,dispatch_index:M.dispatch_index,content_type:M.content_type??(Y==null?void 0:Y.content_type),recorded_at:ot(M.recorded_at??(Y==null?void 0:Y.recorded_at)??null),route:Y==null?void 0:Y.route};E(x=>{const W=[...x,se];return W.length>8&&W.splice(0,W.length-8),W}),Je(x=>{const W=[...x,se];return W.length>50&&W.splice(0,W.length-50),W})}else M.event==="overlay"&&M.overlay?M.overlay.source==="plan"?_t(Y=>{var fe,ne;const se=Array.isArray(Y)?[...Y]:[],x=(fe=M.overlay.data)==null?void 0:fe.step_id,W={...M.overlay.data,recorded_at:ot(((ne=M.overlay.data)==null?void 0:ne.recorded_at)??M.overlay.recorded_at)};if(x){const be=se.findIndex(wt=>(wt==null?void 0:wt.step_id)===x);if(be>=0)return se[be]={...se[be],...W},se}return se.push(W),se}):jt(Y=>{const se=[...Y,M.overlay];return se.length>20&&se.splice(0,se.length-20),se}):M.event==="annotation"&&M.annotation?Ye(Y=>[...Y,M.annotation]):M.event==="error"&&re(M.message)}catch(M){console.error("Failed to parse task stream event",M)}},V=()=>{if(!(d||X))try{const le=Q.openTaskStream(p.task_id);F.current=le,re(null),le.onopen=()=>{K(!0),re(null)},le.onmessage=$,le.onerror=()=>{K(!1),re("任务实时连接已断开")},le.onclose=()=>{F.current=null,K(!1),!d&&!X&&(re(M=>M||"任务实时连接已关闭"),k())}}catch(le){console.error("Failed to open task stream",le),K(!1),re("无法连接任务实时流"),k()}};return X?(K(!1),re("实时伴随已暂停"),m(),()=>{d=!0,C(),m()}):(V(),()=>{d=!0,C(),m()})},[a,p,X,D]);const ya=async()=>{if(p){_e(!0);try{await Q.executeTask(p.task_id),P.success("已触发重新执行"),await vt(p.task_id),nt()}catch(d){console.error(d),P.error("重新执行失败")}finally{_e(!1)}}},_a=async()=>{if(p){te(!0);try{await Q.cancelTask(p.task_id),P.success("取消请求已提交"),await vt(p.task_id),nt()}catch(d){console.error(d),P.error("终止任务失败")}finally{te(!1)}}},ga=async()=>{if(!(u!=null&&u.plan)){P.warning("请选择包含计划的任务");return}ye(!0);try{const d=await Q.runGatewayPlan(u.plan);P.success(`Gateway 已启动任务 ${d.task_id}`),await nt(),await vt(d.task_id)}catch(d){console.error(d),P.error(d instanceof Error?d.message:"Gateway 执行失败")}finally{ye(!1)}},Nr=y.useCallback(async d=>{var m;if(!p){P.error("请选择任务");return}const C=(m=d.note)==null?void 0:m.trim();if(!C){P.error("请输入批注内容");return}Qt(!0);try{const k=await Q.createTaskAnnotation(p.task_id,{...d,note:C});Ye($=>[...$,k]),He.resetFields(),P.success("已添加批注")}catch(k){console.error(k),P.error("添加批注失败")}finally{Qt(!1)}},[He,p]),ja=async()=>{if(p)try{const d=await Q.getTaskLogs(p.task_id),C=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),m=URL.createObjectURL(C),k=document.createElement("a");k.href=m,k.download=`task-${p.task_id}-logs.json`,k.click(),URL.revokeObjectURL(m)}catch(d){console.error(d),P.error("导出日志失败")}},ba=y.useMemo(()=>{if(Yt)return s.jsx("div",{className:T.loadingPanel,children:s.jsx(Pe,{})});if(!ue||!ue.items.length)return s.jsx(oe,{description:"暂无采集结果"});const d=ue.summary,C=Object.entries((d==null?void 0:d.by_content_type)??{}),m=[{title:"标签",dataIndex:"label",key:"label",width:220,render:(k,$)=>s.jsxs("div",{children:[s.jsx(I.Text,{strong:!0,children:k}),s.jsx("br",{}),s.jsxs(I.Text,{type:"secondary",style:{fontSize:12},children:["Step ",$.step_index+1," · ",$.step_id]})]})},{title:"文件名",dataIndex:"filename",key:"filename",width:220,render:(k,$)=>Ne($)},{title:"类型",dataIndex:"content_type",key:"content_type",width:200},{title:"大小",dataIndex:"byte_len",key:"byte_len",width:140,render:k=>Qs(k)},{title:"操作",key:"artifact-actions",width:200,render:(k,$)=>s.jsxs(L,{children:[s.jsx(Z,{type:"link",size:"small",icon:s.jsx(zt,{}),onClick:()=>bt($),children:"下载"}),$.data_base64&&$.content_type.includes("json")&&s.jsx(Z,{type:"link",size:"small",icon:s.jsx($r,{}),onClick:()=>Tr($),children:"预览"})]})}];return s.jsxs("div",{className:T.artifactSection,children:[s.jsxs(U,{bordered:!0,size:"small",column:3,className:T.artifactSummary,children:[s.jsx(U.Item,{label:"数量",children:(d==null?void 0:d.count)??ue.items.length}),s.jsx(U.Item,{label:"总大小",children:d!=null&&d.total_bytes?Qs(d.total_bytes):"—"}),s.jsx(U.Item,{label:"任务 ID",children:ue.task_id})]}),C.length>0&&s.jsx(G,{size:"small",header:s.jsx(I.Text,{strong:!0,children:"内容类型分布"}),dataSource:C,renderItem:([k,$])=>s.jsx(G.Item,{children:s.jsxs(L,{children:[s.jsx(q,{children:k}),s.jsxs(I.Text,{type:"secondary",children:[$," 个"]})]})})}),s.jsx(rr,{className:T.artifactTable,dataSource:ue.items,rowKey:k=>`${k.action_id}-${k.artifact_index}`,pagination:!1,size:"small",columns:m})]})},[Ne,ue,Yt,bt,Tr]),va=y.useMemo(()=>{var Y,se;const d=(se=(Y=u==null?void 0:u.plan)==null?void 0:Y.plan)==null?void 0:se.overlays,C=pe.length?pe:Array.isArray(d)?d:[],m=Array.isArray(g==null?void 0:g.recent_evidence)?g==null?void 0:g.recent_evidence:[],$=(_.length?_:m).filter(x=>(x==null?void 0:x.content_type)&&String(x.content_type).startsWith("image/")&&(x.data_base64||x.screenshot_path)),V=(()=>{const x=new Map;return $.forEach((W,fe)=>{W!=null&&W.step_id&&x.set(String(W.step_id),`evidence-card-${fe}`)}),x})(),le=C.map((x,W)=>{const fe=(x==null?void 0:x.step_id)??"",ne=typeof(g==null?void 0:g.current_step)=="number"&&(g==null?void 0:g.current_step)===W&&(g!=null&&g.current_step_title)?"运行中":fe&&V.has(String(fe))?"已观测":"待执行";return{stepId:fe,title:(x==null?void 0:x.title)||(x==null?void 0:x.action)||"步骤",locator:x==null?void 0:x.locator,status:ne}}),M=x=>{if(!x)return;const W=["x","y","width","height"];if(!W.every(be=>typeof x[be]=="number"))return;const fe=W.every(be=>x[be]>=0&&x[be]<=1),ne={position:"absolute",border:"2px solid #ff7875",boxShadow:"0 0 0 1px rgba(255,120,117,0.4)",borderRadius:4};return fe?(ne.left=`${x.x*100}%`,ne.top=`${x.y*100}%`,ne.width=`${x.width*100}%`,ne.height=`${x.height*100}%`):(ne.left=x.x,ne.top=x.y,ne.width=x.width,ne.height=x.height),ne};return s.jsxs("div",{className:T.visualPanel,children:[s.jsxs("div",{children:[s.jsx(I.Title,{level:5,children:"计划锚点"}),C&&C.length?s.jsx(G,{size:"small",dataSource:C,locale:{emptyText:"暂无定位信息"},renderItem:(x,W)=>s.jsx(G.Item,{className:T.clickable,onClick:()=>{var ne;const fe=(x==null?void 0:x.step_id)&&V.get(String(x.step_id));fe&&((ne=document.getElementById(fe))==null||ne.scrollIntoView({behavior:"smooth",block:"center"}))},children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsxs(L,{size:"small",children:[s.jsx(q,{color:"blue",children:(x==null?void 0:x.step_id)??`step-${W+1}`}),s.jsx(I.Text,{children:(x==null?void 0:x.title)||(x==null?void 0:x.action)||"步骤"})]}),(x==null?void 0:x.locator)&&s.jsx(I.Text,{type:"secondary",className:T.locatorText,children:JSON.stringify(x.locator)})]})},(x==null?void 0:x.step_id)??W)}):s.jsx(oe,{description:"暂无计划锚点"})]}),s.jsxs("div",{children:[s.jsx(I.Title,{level:5,children:"执行时间线"}),le.length?s.jsx(G,{size:"small",dataSource:le,locale:{emptyText:"暂无时间线"},renderItem:(x,W)=>s.jsx(G.Item,{className:`${T.timelineItem} ${T.clickable}`,onClick:()=>{var ne;const fe=x.stepId&&V.get(String(x.stepId));fe&&((ne=document.getElementById(fe))==null||ne.scrollIntoView({behavior:"smooth",block:"center"}))},children:s.jsxs(L,{direction:"vertical",size:2,children:[s.jsxs(L,{size:"small",children:[s.jsx(q,{color:"geekblue",children:x.stepId||`step-${W+1}`}),s.jsx(q,{color:x.status==="运行中"?"processing":x.status==="已观测"?"success":"default",children:x.status}),s.jsx(I.Text,{children:x.title})]}),x.locator&&s.jsx(I.Text,{type:"secondary",className:T.locatorText,children:JSON.stringify(x.locator)})]})},x.stepId||W)}):s.jsx(oe,{description:"暂无时间线"})]}),s.jsxs("div",{children:[s.jsx(I.Title,{level:5,children:"最新视觉证据"}),$.length?s.jsx("div",{className:T.evidenceGrid,children:$.map((x,W)=>{var fe;return s.jsxs("div",{id:`evidence-card-${W}`,className:T.evidenceCard,children:[s.jsx(I.Text,{className:T.evidenceLabel,children:(x==null?void 0:x.label)||(x==null?void 0:x.dispatch_label)||"截图"}),x.data_base64||x.screenshot_path?s.jsxs("div",{className:T.overlayWrapper,children:[s.jsx("img",{src:x.data_base64?`data:${x.content_type};base64,${x.data_base64}`:x.screenshot_path,alt:(x==null?void 0:x.label)||`evidence-${W}`}),M(x==null?void 0:x.bbox)&&s.jsx("div",{className:T.overlayBox,style:M(x==null?void 0:x.bbox),children:s.jsxs("span",{className:T.overlayLabel,children:[(x==null?void 0:x.step_id)||"step",x!=null&&x.dispatch_label?` · ${x.dispatch_label}`:""]})})]}):s.jsxs(I.Text,{type:"secondary",children:["无内嵌截图，可通过路径查看: ",x.screenshot_path||"不可用"]}),s.jsxs(I.Text,{type:"secondary",children:[Qs(x==null?void 0:x.byte_len)," · ",(x==null?void 0:x.step_id)||"step",x!=null&&x.dispatch_label?` · ${x.dispatch_label}`:"",typeof(x==null?void 0:x.dispatch_index)=="number"?` #${x.dispatch_index+1}`:"",(fe=x==null?void 0:x.route)!=null&&fe.page?` · page ${x.route.page}`:""]}),(x==null?void 0:x.bbox)!==void 0&&(x==null?void 0:x.bbox)!==null&&s.jsxs(I.Text,{type:"secondary",className:T.locatorText,children:["bbox: ",JSON.stringify(x.bbox)]})]},`${(x==null?void 0:x.step_id)??"evidence"}-${W}`)})}):s.jsx(oe,{description:"暂无截图"})]})]})},[g,u,_,pe]),wa=y.useMemo(()=>{var k,$;if(!f)return s.jsx(oe,{description:"暂无上下文数据"});const d=f.screenshot_base64,C=Array.isArray((k=f.perception)==null?void 0:k.insights)?($=f.perception)==null?void 0:$.insights:[],m=f.perception;return s.jsxs("div",{className:T.contextPanel,children:[s.jsxs("div",{className:T.contextMedia,children:[d?s.jsx("img",{src:`data:image/png;base64,${d}`,alt:"页面截图"}):s.jsx(oe,{description:"暂无截图"}),f.stderr&&s.jsx(Le,{type:"warning",showIcon:!0,message:f.stderr,style:{marginTop:12}}),f.stdout&&s.jsx(I.Paragraph,{className:T.contextStdout,children:f.stdout})]}),s.jsxs("div",{className:T.contextInfo,children:[s.jsxs(U,{bordered:!0,size:"small",column:1,children:[s.jsx(U.Item,{label:"抓取状态",children:f.success===!1?s.jsx(q,{color:"error",children:"失败"}):s.jsx(q,{color:"success",children:"成功"})}),f.error!==void 0&&f.error!==null&&s.jsx(U.Item,{label:"错误信息",children:Wu(f.error)})]}),C.length?s.jsxs("div",{style:{marginTop:16},children:[s.jsx(I.Text,{strong:!0,children:"洞察"}),s.jsx(G,{size:"small",dataSource:C,style:{marginTop:8},renderItem:(V,le)=>s.jsx(G.Item,{children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsxs(L,{children:[s.jsx(q,{color:"purple",children:(V==null?void 0:V.type)||"insight"}),s.jsx(I.Text,{children:(V==null?void 0:V.severity)||"info"})]}),s.jsx(I.Text,{children:(V==null?void 0:V.message)||"（无描述）"})]})},(V==null?void 0:V.type)??le)})]}):null,m&&s.jsxs("div",{className:T.contextJson,children:[s.jsx(I.Text,{type:"secondary",children:"感知结构"}),s.jsx("pre",{children:JSON.stringify(m,null,2)})]})]})]})},[f]),Sa=y.useMemo(()=>s.jsxs("div",{className:T.annotationPanel,children:[s.jsxs("div",{children:[s.jsx(I.Title,{level:5,children:"批注列表"}),tt.length?s.jsx(G,{size:"small",dataSource:tt,className:T.annotationList,renderItem:d=>s.jsx(G.Item,{children:s.jsxs(L,{direction:"vertical",size:0,children:[s.jsxs(L,{size:"small",children:[s.jsx(q,{color:"purple",children:d.step_id||"step"}),d.severity&&s.jsx(q,{color:"volcano",children:d.severity}),s.jsxs(I.Text,{type:"secondary",children:[it(d.created_at),d.author?` · ${d.author}`:""]})]}),s.jsx(I.Text,{children:d.note}),d.bbox!==void 0&&d.bbox!==null&&s.jsxs(I.Text,{type:"secondary",className:T.locatorText,children:["bbox: ",JSON.stringify(d.bbox)]})]})},d.id)}):s.jsx(oe,{description:"暂无批注"})]}),s.jsxs("div",{children:[s.jsx(I.Title,{level:5,children:"新增批注"}),s.jsxs(z,{layout:"vertical",className:T.annotationForm,form:He,onFinish:Nr,children:[s.jsxs(L,{direction:"horizontal",size:12,wrap:!0,children:[s.jsx(z.Item,{label:"Step ID",name:"step_id",style:{flex:1},children:s.jsx(xe,{placeholder:"可选，例如 llm-step-2",allowClear:!0})}),s.jsx(z.Item,{label:"Dispatch",name:"dispatch_label",style:{flex:1},children:s.jsx(xe,{placeholder:"可选，例如 take-screenshot",allowClear:!0})}),s.jsx(z.Item,{label:"Severity",name:"severity",style:{width:160},children:s.jsx(Re,{allowClear:!0,options:[{value:"info",label:"info"},{value:"warn",label:"warn"},{value:"critical",label:"critical"}],placeholder:"级别"})})]}),s.jsx(z.Item,{label:"作者",name:"author",children:s.jsx(xe,{placeholder:"可选",allowClear:!0})}),s.jsx(z.Item,{label:"批注内容",name:"note",rules:[{required:!0,message:"请输入批注内容"}],children:s.jsx(Xs,{rows:3,placeholder:"描述问题或补充说明",allowClear:!0})}),s.jsx(Z,{type:"primary",htmlType:"submit",loading:Xt,children:"提交批注"})]})]})]}),[tt,He,Xt,Nr]),Ta=y.useMemo(()=>s.jsxs(L,{direction:"vertical",size:"large",style:{width:"100%"},children:[s.jsx(qu,{taskId:p==null?void 0:p.task_id,status:g,latestFrame:Sr,frames:Ot,overlays:gt,annotations:tt,streamConnected:O,streamPaused:X,streamError:A,onTogglePause:kr,onReconnect:Ir,onPreviewFrame:Et,onPreviewOverlay:Ls,onRefreshSummary:Cr}),s.jsx(Hu,{planOverlays:pe,executionOverlays:gt,logs:N,recentEvidence:_,onPreviewEvidence:Et,onPreviewOverlay:Ls})]}),[tt,gt,Et,Ls,Ir,Sr,Ot,g,N,pe,_,Cr,p==null?void 0:p.task_id,O,A,X,kr]),Ca=y.useMemo(()=>Xu((u==null?void 0:u.plan)??null,ke),[ke,u==null?void 0:u.plan]),Rr=y.useCallback(d=>{if(!d.length){P.warning("没有可导出的观测记录");return}try{ts(!0);const C=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),m=URL.createObjectURL(C),k=document.createElement("a");k.href=m;const $=p?`${p.task_id}-observations.json`:`observations-${Date.now()}.json`;k.download=$,k.click(),URL.revokeObjectURL(m),P.success("观测记录已导出")}catch(C){console.error(C),P.error("导出观测记录失败")}finally{ts(!1)}},[p]),ka=y.useMemo(()=>{if(!st.length)return s.jsx(oe,{description:"暂无观测"});const d=[...st].filter(m=>Xe==="all"?!0:Xe==="image"?((m==null?void 0:m.observation_type)||(m==null?void 0:m.content_type)||"").includes("image"):!((m==null?void 0:m.observation_type)||(m==null?void 0:m.content_type)||"").includes("image")).filter(m=>{if(!Qe.trim())return!0;const k=Qe.trim().toLowerCase();return((m==null?void 0:m.dispatch_label)||"").toLowerCase().includes(k)||((m==null?void 0:m.note)||"").toLowerCase().includes(k)||((m==null?void 0:m.step_id)||"").toLowerCase().includes(k)}).reverse(),C=s.jsxs(L,{style:{marginBottom:12},wrap:!0,children:[s.jsx(Re,{value:Xe,onChange:m=>Zt(m),options:[{value:"all",label:"全部"},{value:"image",label:"仅图像"},{value:"artifact",label:"仅日志/数据"}],style:{width:140},size:"small"}),s.jsx(xe,{allowClear:!0,size:"small",placeholder:"按 Step/Dispatch 过滤",value:Qe,onChange:m=>Pt(m.target.value),style:{width:220}}),Qe||Xe!=="all"?s.jsx(Z,{size:"small",onClick:()=>{Zt("all"),Pt("")},children:"重置"}):null]});return s.jsxs("div",{children:[s.jsxs(L,{align:"center",style:{marginBottom:12},wrap:!0,children:[C,s.jsx(Z,{icon:s.jsx(zt,{}),size:"small",loading:es,disabled:!st.length,onClick:()=>Rr(d),children:"导出 JSON"})]}),s.jsx(G,{size:"small",dataSource:d,className:T.logsPanel,renderItem:(m,k)=>{const $=Ie(m);return s.jsx(G.Item,{className:T.timelineItem,children:s.jsxs(L,{direction:"vertical",size:2,style:{width:"100%"},children:[s.jsxs(L,{size:"small",wrap:!0,children:[s.jsx(q,{color:"geekblue",children:(m==null?void 0:m.observation_type)||"observation"}),(m==null?void 0:m.dispatch_label)&&s.jsx(q,{children:m.dispatch_label}),(m==null?void 0:m.step_id)&&s.jsxs(q,{color:"default",children:["Step ",m.step_id]}),s.jsx(I.Text,{type:"secondary",children:it(m==null?void 0:m.recorded_at)})]}),(m==null?void 0:m.note)&&s.jsx(I.Text,{children:m.note}),(m==null?void 0:m.bbox)&&s.jsxs(I.Text,{type:"secondary",className:T.locatorText,children:["bbox: ",JSON.stringify(m.bbox)]}),$?s.jsx("img",{src:$,alt:(m==null?void 0:m.label)||"observation-preview",className:T.previewableImage,onClick:()=>Et(m)}):null]})},`${(m==null?void 0:m.recorded_at)||k}-${k}`)}})]})},[es,Rr,Et,Ie,Qe,st,Xe]),Ia=()=>{je(!0)},Pr=()=>{je(!1),ze.resetFields(),we(null)},Fs=y.useCallback((d,C)=>{const m=Gu(d.metadata)?d.metadata:{},k={},$=St(m.prompt);$&&(k.prompt=$);const V=St(m.current_url??m.currentUrl);V&&(k.currentUrl=V);const le=m.constraints;if(Array.isArray(le)){const At=le.filter(Oa=>typeof Oa=="string");At.length&&(k.constraints=At.join(`
`))}else{const At=St(le);At&&(k.constraints=At)}const M=St(m.planner);(M==="rule"||M==="llm")&&(k.planner=M);const Y=St(m.llm_provider??m.llmProvider);Y&&(k.llmProvider=Y);const se=St(m.llm_model??m.llmModel);se&&(k.llmModel=se);const x=tr(m.execute);typeof x=="boolean"&&(k.execute=x);const W=er(m.max_replans??m.maxReplans);typeof W=="number"&&(k.maxReplans=W);const fe=er(m.max_retries??m.maxRetries);typeof fe=="number"&&(k.maxRetries=fe);const ne=tr(m.capture_context??m.captureContext);typeof ne=="boolean"&&(k.captureContext=ne);const be=tr(m.context_screenshot??m.contextScreenshot);typeof be=="boolean"&&(k.contextScreenshot=be);const wt=er(m.context_timeout_secs??m.contextTimeoutSecs);typeof wt=="number"&&(k.contextTimeout=wt),Object.keys(k).length>0&&ze.setFieldsValue(k),ze.setFieldsValue({templateId:d.id}),we(d),(C==null?void 0:C.openModal)!==!1&&je(!0),(C==null?void 0:C.notify)!==!1&&P.success(`已加载模板：${d.key}`)},[ze]),Na=y.useCallback(d=>{Fs(d)},[Fs]),Er=y.useCallback(()=>{we(null),ze.setFieldsValue({templateId:void 0})},[ze]),Ra=async()=>{var d,C;try{const m=await ze.validateFields();Me(!0);const k=m.constraints?m.constraints.split(`
`).map(le=>le.trim()).filter(le=>le.length>0):void 0,$={prompt:m.prompt.trim(),planner:m.planner,execute:m.execute??!1,max_replans:m.maxReplans,max_retries:m.maxRetries,constraints:k&&k.length?k:void 0,current_url:((d=m.currentUrl)==null?void 0:d.trim())||void 0};typeof m.captureContext=="boolean"&&($.capture_context=m.captureContext),m.captureContext&&($.context_screenshot=m.contextScreenshot??!0,m.contextTimeout&&m.contextTimeout>0&&($.context_timeout_secs=m.contextTimeout)),m.planner==="llm"&&($.llm_provider=m.llmProvider,m.llmModel&&($.llm_model=m.llmModel.trim())),j&&($.template_id=j.id,$.template_ref=`${j.namespace}:${j.key}`);const V=await Q.createTask($);if(V.success)P.success(V.task_id?`任务已创建：${V.task_id}`:"任务已创建"),Pr(),nt();else{const le=((C=V.stderr)==null?void 0:C.join(`
`))||"任务创建失败";P.error(le)}}catch(m){if(m!=null&&m.errorFields)return;console.error(m),P.error("任务创建失败")}finally{Me(!1)}},Pa=y.useMemo(()=>[{title:"任务 ID",dataIndex:"task_id",key:"task_id",width:280,render:d=>s.jsx(I.Text,{copyable:!0,ellipsis:{tooltip:d},children:d})},{title:"状态",dataIndex:"last_status",key:"last_status",width:140,render:d=>fn(d)},{title:"提示词",dataIndex:"prompt",key:"prompt",ellipsis:!0,render:d=>d||"—"},{title:"来源",dataIndex:"source",key:"source",width:120,render:d=>d||"—"},{title:"Planner",dataIndex:"planner",key:"planner",width:120,render:d=>d||"—"},{title:"最近更新",dataIndex:"last_recorded_at",key:"last_recorded_at",width:200,render:(d,C)=>it(C.last_recorded_at||C.created_at)},{title:"操作",key:"actions",width:120,render:(d,C)=>s.jsx(Z,{type:"link",icon:s.jsx(hs,{}),onClick:()=>ma(C),children:"详情"})}],[]),Ae=(u==null?void 0:u.summary)||p,Ea=(g==null?void 0:g.status)||(Ae==null?void 0:Ae.last_status);return s.jsxs("div",{className:T.page,children:[s.jsxs("div",{className:T.header,children:[s.jsxs("div",{children:[s.jsx(I.Title,{level:3,children:"任务中心"}),s.jsx(I.Text,{type:"secondary",children:"查看历史任务、执行状态以及调度详情"})]}),s.jsxs(L,{children:[s.jsx(Z,{icon:s.jsx(yr,{}),onClick:nt,loading:r,children:"刷新"}),s.jsx(Z,{type:"primary",icon:s.jsx(_n,{}),onClick:Ia,children:"新建任务"})]})]}),s.jsx("div",{className:T.tableWrapper,children:e.length===0&&!r?s.jsx(oe,{description:"暂无任务，尝试在聊天中执行新任务"}):s.jsx(rr,{rowKey:d=>d.task_id,dataSource:e,columns:Pa,loading:r,pagination:{pageSize:10}})}),s.jsx(Ju,{onApplyTemplate:Na,onTemplateDeleted:d=>{(j==null?void 0:j.id)===d.id&&Er()},onTemplateUpdated:d=>{(j==null?void 0:j.id)===d.id&&Fs(d,{openModal:!1,notify:!1})}}),s.jsx(fo,{title:Ae?`任务详情：${Ae.task_id}`:"任务详情",width:960,open:a,onClose:xa,destroyOnClose:!0,children:l?s.jsx("div",{className:T.loadingPanel,children:s.jsx(Pe,{})}):Ae?s.jsxs(s.Fragment,{children:[s.jsxs(U,{bordered:!0,column:2,size:"small",children:[s.jsx(U.Item,{label:"状态",children:fn(Ea)}),s.jsx(U.Item,{label:"来源",children:Ae.source||"—"}),s.jsx(U.Item,{label:"Planner",children:Ae.planner||"—"}),s.jsx(U.Item,{label:"LLM Provider",children:Ae.llm_provider||"—"}),s.jsx(U.Item,{label:"LLM Model",children:Ae.llm_model||"—"}),s.jsx(U.Item,{label:"提示词",span:2,children:Ae.prompt||"—"}),s.jsx(U.Item,{label:"创建时间",children:it(Ae.created_at)}),s.jsx(U.Item,{label:"最近更新",children:it(Ae.last_recorded_at)})]}),s.jsx(ho,{className:T.detailTabs,items:[{key:"plan",label:"计划详情",children:Ca},{key:"companion",label:"实时伴随",children:Ta},{key:"context",label:"页面上下文",children:wa},{key:"dispatches",label:"调度记录",children:Qu((u==null?void 0:u.dispatches)??[])},{key:"observations",label:"观测流水",children:ka},{key:"logs",label:"实时日志",children:s.jsxs("div",{className:T.logsPanel,children:[A&&s.jsx(Le,{type:"warning",message:A,showIcon:!0,closable:!0}),N.length?s.jsx(G,{size:"small",dataSource:N,renderItem:(d,C)=>s.jsx(G.Item,{className:T.logItem,children:s.jsxs(L,{size:"small",children:[s.jsx(I.Text,{type:"secondary",children:it(d.timestamp)}),s.jsx(q,{color:Vu[d.level]||"default",children:d.level.toUpperCase()}),s.jsx(I.Text,{children:d.message})]})},`${d.timestamp}-${C}`)}):s.jsx(oe,{description:"暂无日志"})]})},{key:"artifacts",label:"采集结果",children:ba},{key:"visuals",label:"视觉锚点",children:va},{key:"annotations",label:"批注",children:Sa}]}),s.jsx("div",{className:T.actionBar,children:s.jsxs(L,{children:[s.jsx(Z,{icon:s.jsx(mo,{}),loading:de,onClick:ya,type:"primary",children:"重新执行"}),s.jsx(Z,{icon:s.jsx($r,{}),loading:ie,onClick:ga,children:"Gateway 执行"}),s.jsx(Z,{icon:s.jsx(xo,{}),danger:!0,loading:S,onClick:_a,children:"终止任务"}),s.jsx(Z,{icon:s.jsx(zt,{}),onClick:ja,children:"导出日志"})]})})]}):s.jsx(oe,{description:"暂无详情"})}),s.jsx(ds,{title:mt.title||"Artifact 预览",open:mt.visible,onCancel:()=>xt({visible:!1}),footer:null,width:720,destroyOnClose:!0,children:s.jsx("pre",{className:T.previewBlock,children:mt.content||"暂无内容"})}),s.jsx(ds,{title:Ke.title||"图像预览",open:Ke.visible,onCancel:ha,footer:null,width:720,destroyOnClose:!0,children:Ke.src?s.jsx("img",{src:Ke.src,alt:Ke.title||"evidence-preview",className:T.previewableImage,style:{maxHeight:"70vh"}}):s.jsx(oe,{description:"暂无可预览的图像"})}),s.jsxs(ds,{title:"新建任务",open:ge,onCancel:Pr,onOk:Ra,confirmLoading:Ce,destroyOnClose:!0,children:[j&&s.jsx(Le,{type:"info",showIcon:!0,className:T.templateAlert,message:s.jsxs(L,{size:8,wrap:!0,children:[s.jsx(I.Text,{strong:!0,children:"已加载模板"}),s.jsx(q,{color:"geekblue",children:j.namespace}),s.jsx(I.Text,{children:j.key})]}),action:s.jsx(Z,{size:"small",onClick:Er,children:"清除"}),style:{marginBottom:12}}),s.jsxs(z,{layout:"vertical",form:ze,initialValues:{planner:"rule",llmProvider:"mock",execute:!1,maxReplans:0,maxRetries:1,captureContext:!0,contextScreenshot:!0,contextTimeout:25},children:[s.jsx(z.Item,{label:"任务提示",name:"prompt",rules:[{required:!0,message:"请输入任务描述"}],children:s.jsx(Xs,{rows:4,placeholder:"描述需要自动化完成的目标",allowClear:!0})}),s.jsx(z.Item,{label:"当前 URL",name:"currentUrl",children:s.jsx(xe,{placeholder:"https://example.com",allowClear:!0})}),s.jsx(z.Item,{label:"额外约束",name:"constraints",children:s.jsx(Xs,{rows:2,placeholder:"可选，每行一个约束",allowClear:!0})}),s.jsx(z.Item,{label:"Planner",name:"planner",children:s.jsx(Re,{options:[{label:"Rule-based",value:"rule"},{label:"LLM",value:"llm"}]})}),s.jsx(z.Item,{label:"LLM Provider",name:"llmProvider",hidden:!rt,rules:rt?[{required:!0,message:"请选择 LLM Provider"}]:[],children:s.jsx(Re,{disabled:!rt,options:[{label:"Mock",value:"mock"},{label:"OpenAI",value:"openai"},{label:"Claude",value:"claude"}]})}),s.jsx(z.Item,{label:"LLM Model",name:"llmModel",hidden:!rt,children:s.jsx(xe,{placeholder:"如 gpt-4o-mini",disabled:!rt,allowClear:!0})}),s.jsx(z.Item,{label:"立即执行",name:"execute",valuePropName:"checked",children:s.jsx(cs,{})}),s.jsx(z.Item,{label:"最大重新规划次数",name:"maxReplans",children:s.jsx(Tt,{min:0,style:{width:"100%"}})}),s.jsx(z.Item,{label:"每步最大重试次数",name:"maxRetries",children:s.jsx(Tt,{min:1,style:{width:"100%"}})}),s.jsx(z.Item,{label:"捕获页面上下文",name:"captureContext",valuePropName:"checked",children:s.jsx(cs,{})}),rs?s.jsxs(s.Fragment,{children:[s.jsx(z.Item,{label:"保存上下文截图",name:"contextScreenshot",valuePropName:"checked",children:s.jsx(cs,{})}),s.jsx(z.Item,{label:"上下文超时（秒）",name:"contextTimeout",children:s.jsx(Tt,{min:5,max:120,style:{width:"100%"}})})]}):null,s.jsx(z.Item,{name:"templateId",hidden:!0,children:s.jsx(xe,{type:"hidden"})})]})]})]})}const Xu=(e,t)=>e?s.jsxs("div",{className:T.jsonPanel,children:[s.jsx(L,{style:{marginBottom:12},children:s.jsx(Z,{type:"primary",icon:s.jsx(zt,{}),onClick:()=>t==null?void 0:t(e),children:"导出 JSON"})}),s.jsxs(U,{bordered:!0,column:3,size:"small",style:{marginBottom:12},children:[s.jsx(U.Item,{label:"Planner",children:e.planner}),s.jsx(U.Item,{label:"LLM Provider",children:e.llm_provider||"—"}),s.jsx(U.Item,{label:"LLM Model",children:e.llm_model||"—"})]}),s.jsx(I.Paragraph,{copyable:!0,strong:!0,children:"计划结构"}),s.jsx("pre",{children:JSON.stringify(e.plan,null,2)}),s.jsx(I.Paragraph,{copyable:!0,strong:!0,children:"执行流定义"}),s.jsx("pre",{children:JSON.stringify(e.flow,null,2)})]}):s.jsx(oe,{description:"暂无计划数据"}),Qu=e=>e.length?s.jsx(rr,{dataSource:e,size:"small",rowKey:t=>t.action_id,pagination:!1,columns:[{title:"Action ID",dataIndex:"action_id",ellipsis:!0},{title:"工具",dataIndex:"tool",width:140},{title:"状态",dataIndex:"status",width:120},{title:"等待/执行 (ms)",width:160,render:(t,r)=>`${r.wait_ms} / ${r.run_ms}`},{title:"记录时间",dataIndex:"recorded_at",width:200,render:t=>it(t)}]}):s.jsx(oe,{description:"暂无调度记录"}),Zu=e=>{try{const t=atob(e);return decodeURIComponent(t.split("").map(r=>`%${("00"+r.charCodeAt(0).toString(16)).slice(-2)}`).join(""))}catch{return atob(e)}},ep="_wrapper_1g7oe_1",tp="_sectionCard_1g7oe_7",sp="_sectionTitle_1g7oe_11",rp="_statsGrid_1g7oe_17",np="_alertList_1g7oe_23",ap="_featuresList_1g7oe_29",op="_policyList_1g7oe_35",lp="_policyItem_1g7oe_43",ip="_pluginSummary_1g7oe_49",Se={wrapper:ep,sectionCard:tp,sectionTitle:sp,statsGrid:rp,alertList:np,featuresList:ap,policyList:op,policyItem:lp,pluginSummary:ip},ls=e=>`${e} ms`,cp=e=>`${(e/1e3).toFixed(1)} s`;function dp(){const[e,t]=y.useState(null),[r,n]=y.useState(!1),[a,o]=y.useState(null),l=async()=>{n(!0),o(null);try{const p=await Q.getGovernanceOverview();t(p)}catch(p){o(p instanceof Error?p.message:"加载治理信息失败")}finally{n(!1)}};y.useEffect(()=>{l()},[]);const c=p=>p.length?s.jsx("div",{className:Se.alertList,children:p.map((i,u)=>s.jsx(Le,{type:i.level,message:i.message,description:i.details,showIcon:!0},`alert-${u}`))}):s.jsx(Le,{type:"success",message:"暂无治理告警",showIcon:!0});return s.jsxs("div",{className:Se.wrapper,children:[s.jsxs(L,{direction:"horizontal",style:{justifyContent:"space-between"},children:[s.jsxs("div",{className:Se.sectionTitle,children:[s.jsx(Ft,{}),s.jsx("h2",{style:{margin:0},children:"治理中心"})]}),s.jsx(Z,{onClick:()=>l(),loading:r,type:"link",children:"刷新"})]}),a&&s.jsx(Le,{type:"error",message:a,showIcon:!0,closable:!0,onClose:()=>o(null)}),s.jsx(he,{className:Se.sectionCard,title:"治理告警",children:r&&!e?s.jsx(Pe,{}):e?c(e.alerts):s.jsx(oe,{description:"暂无数据"})}),s.jsx(he,{className:Se.sectionCard,title:s.jsxs("div",{className:Se.sectionTitle,children:[s.jsx(mr,{}),"调度与配额"]}),children:e?s.jsxs("div",{className:Se.statsGrid,children:[s.jsx(me,{title:"策略版本",value:e.policy.revision}),s.jsx(me,{title:"Global Slots",value:e.policy.scheduler_limits.global_slots}),s.jsx(me,{title:"Per Task",value:e.policy.scheduler_limits.per_task_limit}),s.jsx(me,{title:"队列容量",value:e.policy.scheduler_limits.queue_capacity}),s.jsx(me,{title:"最大重试",value:e.policy.retry.max_attempts}),s.jsx(me,{title:"退避",value:cp(e.policy.retry.backoff_ms)}),s.jsx(me,{title:"Navigate",value:ls(e.policy.scheduler_timeouts.navigate_ms)}),s.jsx(me,{title:"Click",value:ls(e.policy.scheduler_timeouts.click_ms)}),s.jsx(me,{title:"Type",value:ls(e.policy.scheduler_timeouts.type_text_ms)}),s.jsx(me,{title:"Screenshot",value:ls(e.policy.scheduler_timeouts.screenshot_ms)})]}):r?s.jsx(Pe,{}):s.jsx(oe,{description:"暂无配额数据"})}),s.jsx(he,{className:Se.sectionCard,title:s.jsxs("div",{className:Se.sectionTitle,children:[s.jsx(Ft,{}),"功能开关"]}),children:e?s.jsxs("div",{className:Se.featuresList,children:[s.jsxs(q,{color:e.policy.features.metrics_export?"green":"red",children:["指标导出：",e.policy.features.metrics_export?"开启":"关闭"]}),s.jsxs(q,{color:e.policy.features.state_center_persistence?"green":"red",children:["State Center 持久化：",e.policy.features.state_center_persistence?"开启":"关闭"]}),s.jsxs(q,{color:e.policy.features.registry_ingest_bus?"blue":"default",children:["Registry Ingest Bus：",e.policy.features.registry_ingest_bus?"开启":"关闭"]}),s.jsxs(q,{color:e.policy.registry.allow_multiple_pages?"blue":"default",children:["多页面：",e.policy.registry.allow_multiple_pages?"允许":"禁止"]}),s.jsxs(q,{color:"default",children:["Health Probe：",e.policy.registry.health_probe_interval_ms," ms"]})]}):r?s.jsx(Pe,{}):s.jsx(oe,{description:"暂无功能信息"})}),s.jsx(he,{className:Se.sectionCard,title:s.jsxs("div",{className:Se.sectionTitle,children:[s.jsx(yo,{}),"策略文件"]}),children:e?s.jsx("ul",{className:Se.policyList,children:e.policy_files.map(p=>s.jsxs("li",{className:Se.policyItem,children:[s.jsx("span",{children:p.path}),s.jsx(q,{color:p.exists?"green":"red",children:p.exists?"可用":"缺失"})]},p.path))}):r?s.jsx(Pe,{}):s.jsx(oe,{description:"暂无策略文件"})}),s.jsx(he,{className:Se.sectionCard,title:s.jsxs("div",{className:Se.sectionTitle,children:[s.jsx(Ft,{}),"插件治理"]}),children:e?s.jsxs("div",{className:Se.pluginSummary,children:[s.jsx(me,{title:"注册插件",value:e.plugins.total_registry_entries}),s.jsx(me,{title:"已启用",value:e.plugins.active_plugins}),s.jsx(me,{title:"待审核",value:e.plugins.pending_review,valueStyle:{color:e.plugins.pending_review>0?"#faad14":void 0}}),s.jsx(me,{title:"最近审核",value:e.plugins.last_reviewed_at?We(e.plugins.last_reviewed_at).format("YYYY-MM-DD HH:mm"):"—"}),e.plugins.registry_path&&s.jsxs(q,{color:"default",children:["Registry: ",e.plugins.registry_path]})]}):r?s.jsx(Pe,{}):s.jsx(oe,{description:"暂无插件信息"})})]})}function up(){return s.jsx(_o,{locale:Jo,theme:{algorithm:go.darkAlgorithm,token:{colorPrimary:"#1890ff",borderRadius:6}},children:s.jsx(Ua,{children:s.jsx(Da,{children:s.jsxs(at,{path:"/",element:s.jsx(xc,{}),children:[s.jsx(at,{index:!0,element:s.jsx(Ba,{to:"/chat",replace:!0})}),s.jsx(at,{path:"chat",element:s.jsx(fd,{})}),s.jsx(at,{path:"perceive",element:s.jsx(jd,{})}),s.jsx(at,{path:"diagnostics",element:s.jsx(Ld,{})}),s.jsx(at,{path:"tasks",element:s.jsx(Yu,{})}),s.jsx(at,{path:"governance",element:s.jsx(dp,{})})]})})})})}nr.createRoot(document.getElementById("root")).render(s.jsx(mn.StrictMode,{children:s.jsx(up,{})}));
//# sourceMappingURL=index-D5i7TVm2.js.map
